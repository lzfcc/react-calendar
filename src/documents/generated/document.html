<h2>簡介</h2><ol><li>本工具的使用對象是古代天文曆法研究者。對於一般文史研究者，推薦使用下面的友情鏈接<n>當然，「時間」板塊的三個工具還是挺有用的</n>。</li><li>目前的古代朔閏査詢網站都是根據工具書、文獻材料手動調整的<n>參考中研院 <a href="https://sinocal.sinica.edu.tw/lusodoc.html">兩千年中西曆轉換說明書</a>，廖育棟 <a href="https://ytliu0.github.io/ChineseCalendar/computation_chinese.html">本網站的農曆編算</a></n>。本工具可提供古代實行未實行的 60 餘部曆法的計算，完全遵照各曆算法進行全自動計算，無手動干預。主要有三大功能區：<ol><li><strong>朔閏表</strong> 每年的積年、冬至大小餘、閏餘；冬至時刻的入轉日、入交泛日、入週天度。各月定朔<n>線性內插、二次三次內插</n>、平朔，定朔時刻日月所在赤道度，定望，平氣、定氣、定氣日昏中星。日月食食甚時刻、食分。</li><li><strong>曆書</strong> 包含天文曆、具注曆兩部份。<ol><li>天文曆：每日太陽赤經、極黃經宿度，日赤緯、日出時刻、正午晷長，月赤經、月赤緯、月行九道/三道。預計 2022 年將推出五星計算。</li><li>具注曆：每年「術數年」積年、男女九宮，年干支五行、納音、魁罡之月，23 種歲神，年九宮色。每月月建、月神、吉時、月九宮色。每日干支、儒略日、公曆日期、納音五行、建除、黃道吉日黑道凶日、七星值日、二十八宿二十八禽值日，二十四節氣時刻、七十二候時刻、沒滅日時刻、土王用事時刻、卦用事時刻，人神、日遊神、血支血忌，10 種日神。</li></ol></li><li><strong>數學工具</strong> 包含同餘、方程、天文、時間四個板塊。<ol><li>同餘：大衍求一術、解一次同餘式、大衍總數術，擬秦九韶調日法、淸人調日法三種、連分數，最大公因數、章蔀紀元法，古曆入元、秦九韶演紀法，從零開始造唐宋曆。</li><li>方程：<del>九章算術開方術、累減開方術，</del>二分迭代法解高次方程，隙積術芻童垛、三角垛落一形垛、四角垛方垛，招差術、拉格朗日內插，會圓術、弧矢割圓術、三斜求積術。</li><li>天文：日躔月離及誤差，太陽赤黃經轉換及誤差，太陽赤緯、日出、晷長及誤差，月亮極白經、赤經、極黃緯，現代天文任意時刻太陽高度、方位角、晷長。</li><li>時間：將萬分小數轉換爲辰刻，儒略日、日期轉換，公元年、年干支轉換。</li></ol></li></ol></li><li>如您發現任何問題，可通過評論框或郵件向我反饋。若您在研究過程中發現程序結果與文獻不符，望不吝提供線索。這個工具是根據研究需要而開發的，如果您有任何功能需求，敬請與我聯繫，我會在力所能及的範圍內儘量實現。</li><li>本工具與以往的朔閏表工具書是相互補充的關係，古人算曆有可能不會完全依照術文，會根據實際情況適當調整，這種情況下計算程序就無能爲力。</li><li>本工具完全開源，如您需要査詢、核査各曆的詳細參數與算法，請前往源碼倉庫。如您不嫌麻煩，可以下載源碼，在本地運行程序。更多技術特徵見開發者說明。核心計算邏輯文件大小：253KB。 <strong>隱私聲明</strong> 本站使用了 Google Analytics 進行流量分析；評論系統採用 Hyvor Talk；服務器託管在 Netlify 平臺。運算均在本地瀏覽器進行。</li><li>可以參考《律曆初階下》：<ol><li><a href="https://kqh.me/key/calendar1">曆法簡史</a></li><li><a href="https://kqh.me/key/calendar2">天學</a></li><li><a href="https://kqh.me/key/calendar3">天文計算</a></li><li><a href="https://kqh.me/key/calendar4">四分系</a></li><li><a href="https://kqh.me/key/calendar6">日神、時間制度</a></li><li><a href="https://kqh.me/key/calendar7">數學工具</a>。本站參考資料見此</li></ol></li></ol><h3>網站推薦</h3><h4>年表</h4><ul><li><a href="https://ytliu0.github.io/ChineseCalendar/index_chinese.html">廖育棟的網站</a> 年曆、氣朔時刻、中國歷史年表、儒略日干支轉換等——DE431</li><li>中研院 <a href="https://sinocal.sinica.edu.tw/">兩千年中西曆轉換</a></li><li><a href="https://www.lishichelun.com/calendar/switch">歷史車輪中西曆轉換器</a></li></ul><h4>實行曆法</h4><ul><li><a href="http://www.wagoyomi.info/">和暦 (わごよみ) &amp; 中華暦（からごよみ）</a> 〔寶藏！〕</li><li>廖育棟的 <a href="http://ytliu.epizy.com/Shixian/index_chinese.html">時憲曆計算</a></li><li><a href="https://kanasimi.github.io/CeJS/_test%20suite/era.htm">紀年轉換工具</a>：世界各國曆法</li></ul><h4>現代天文學中曆</h4><ul><li><a href="http://www.tianqihoubao.com/calendar/calendar.htm">日梭萬年曆</a></li><li><a href="http://www.nongli.net/sxwnl/">壽星天文曆</a>，許劍偉、鄭彥山——VSOP</li><li><a href="https://vert.neocities.org/cld/">萬年天文夏曆</a>，哂蟹齋</li></ul><h4>現代天文學朔閏、交食</h4><ul><li><a href="http://ytliu.epizy.com/eclipse/">Eight Millennia of Eclipses (4000 BCE – 4000 CE)</a> 廖育棟的</li><li><a href="https://eclipse.gsfc.nasa.gov/">NASA Eclipse</a> 五千年，VSOP、ELP-2000/82 算的，太老了</li><li><a href="https://eco.mtk.nao.ac.jp/koyomi/cande/index.html.en">日本國立天文臺在線曆表</a> 有 2009 年以來的七政位置、朔閏、節氣、交食、恆星時等等</li></ul><h4>博客</h4><ul><li><a href="https://tambingblog.wordpress.com/">治曆者言</a> 譚冰的曆法及術數文章彙編 似乎是港中文的畢業生？出版有<v>古今曆術考</v><n>香港：三聯書店，2013</n>。</li></ul><h3>殘曆復原</h3><h4>參數</h4><p>魏<u>韓詡</u>造<v>黃初</v>，他批評<v>乾象</v>減斗分太過<n>回歸年太小</n>，不過實際上<q>「<u>韓翊</u>所造皆用<u>洪</u>法，小益斗下分，所錯無幾。」</q><n>我據占經復原<v>黃初</v>。</p><p>晉武帝泰始十年<n>274</n><u>劉智</u><v>正曆</v><n>我據占經、宋志復原。</p><p>永和八年<n>352</n><u>王朔之</u><v>通曆</v>，<v>宋志</v>：<q>「王朔之以其上元歲在甲子，善其術，欲以九萬七千歲之甲子爲開闢之始，何承天云『悼於立意者也。』」</q>但 97000 的積年完全不對，我調整爲 352 - (97000 - 864)，九萬七千歲是舉整數而言。後來看到曲安京<v>中國曆法與數學</v>，改爲 352 - 90079 試了下<n>上元甲午歲壬子日</n>，但是前後錯開兩個月，肯定不能用。</p><p><u>姜岌</u><v>三紀甲子元</v>。我據晉志下、占經復原。</p><p><u>趙𢾺</u><v>玄始</v><n>玄始元年 412—北涼亡</n>。我據占經、<v>疇人傳</v>卷六復原。</p><p><v>隋志</v>這段材料很重要，576 年：</p><blockquote><p>訖干敬禮及曆家豫刻日食疎密。六月戊申朔，太陽虧，劉孝孫言食於卯時<n>6—7 點</n>，張孟賔言食於甲時<n>5—6 點</n>，鄭元偉、董峻言食於辰時<n>8—9 點</n>，宋景業言食於巳時<n>10—11 點</n>。至日食，乃於卯甲之間<n>6 點</n>，其言皆不能中。</p></blockquote><p>這裏用的是 24 小時方位制計時。</p><p><u>宋景業</u><v>天保</v><n>天保二年 551—亡</n>，月離表據嚴敦傑<v>補北齊書曆志</v><n><v>自然科學史研究</v>1984 年第 3 期</n>補之。問題是戊申定朔在巽時弱，距巳時<n>0.417-0.45</n>還差了一個多小時。</p><p><u>董峻</u>、<u>鄭元偉</u><v>甲寅元</v>，據嚴敦傑<v>補北齊書曆志</v>、曲安京<v>曆法</v>頁 106 補之。曲安京說<v>甲寅</v>沒有日行盈縮，看來我判斷它是北系曆法是正確的。此前用嚴敦傑的上元積年，自己補上了入轉修正，照理說不應該有，後來用曲安京積年，不用補，非常完美。</p><p><v>張孟賔</v>、<v>劉孝孫</v>二曆以占經復原，<v>劉孝孫</v>很完整，<v>張孟賔</v>殘缺。<v>張孟賔</v>此前積年不對，我加上了 -0.379 的經朔修正，後來用曲安京積年，就不用補了。曲安京沒有復原近點月，我用「從零開始造唐宋曆」工具復原，算得甲時少彊，完美貼合記載。日躔月離此前以<v>皇極</v>補之，但改用<v>大業</v>躔離纔能與<v>隋志</v>相合。</p><p><v>隋志</v>還說：</p><blockquote><p>張孟賔以六百一十九爲章，四萬八千九百爲紀，九百四十八爲日法，萬千九百四十五爲斗分。元紀共命，法略旨遠。日月五星，並從斗十一起。盈縮轉度，陰陽分至，與漏刻相符，共日影俱合，循轉無窮。上拒春秋，下盡天統，日月虧食及五星所在，以二人新法考之，無有不合。</p></blockquote><p>「從斗十一起」，說明<v>張孟賔</v>沒有歲差。</p><p><v>明克讓</v><n>武成元年 559—565</n>。我用占經的<v>梁武大同</v>來補<v>明克讓</v>。<v>隋志中</v>：<q>「初，西魏入關，尚行李業興<v>正光術</v>。至武成元年，始詔克讓與麟趾學士庾季才及諸日者定新術，采<u>祖暅</u>舊議，通簡南北之術。自斯已後，頗親其謬。故周齊並時，而曆差一日。」</q>也就是說<v>明克讓</v>綜合南北算法，跟<v>天保</v>差了一天。</p><p><v>大象</v><n>大象元年 579—583</n>。<v>通占大象曆星經</v>與大象曆配套使用，可能是張賔所作<n>許潔<v>隋唐時期的道教星象研究</v>，<v>宗教學研究</v>2009 年第 4 期，第 29 頁</n>，也許可以用來復原大象曆。<v>隋書張冑玄傳</v>：<q>「周马显造 <v>丙寅元历</v>，有阴阳转法，加减章分，进退蚀余，乃推定日，创开此数。当时术者，多不能晓。张宾因而用之，莫能考正。」</q><v>隋書</v>：<q>「小周餘、盈縮積，其曆術別推入蔀會，分用陽率 499，陰率 9。每 12 月下各有日月蝕轉分，推步加減之，乃爲定蝕大小餘，而求加時之正。」</q></p><p>高宗顯慶年間<n>656—661</n>印度曆法<v>九執</v>，全文見占經卷一〇四，顧觀光<v>九執曆解</v><n><v>武陵山人遺書</v>，<v>中國科學技術典籍通匯</v>天文部分 843 頁</n></p><p>術士<u>曹士蔿</u><v>符天</v><n>780-820</n>乃民間小曆，以<q>「相減相乘法」</q>代躔離表，日法用萬分，曆元用雨水，以定氣注曆。<v>崇玄</v>本於<v>大衍</v>，而巧算源自<v>符天</v>。<n>陳久金<v>符天曆研究</v>：<u>祖暅</u>的<v>符天經</v>與後來的<v>符天曆</v>毫無關係。</n></p><p><v>至道</v>上元積年、回歸年、朔望月用曲安京的復原成果，其他參數參照<v>乾元</v> 995 年轉 27.1173 交 7.5243 週 323.2491，用「從零開始造唐宋曆」工具復原。</p><p><v>乾興</v>其他參數參照<v>觀天</v> 1021 年轉 17.1709 交 6.9028 週 319.5299，用「從零開始造唐宋曆」工具復原。</p><p><v>調元</v>。<v>新五代志</v>：<q>「以宣明之氣朔合崇元之五星，二曆相參，然後符合。」</q>失傳，以我復原的<v>符天</v>代之，參數暫用<v>崇玄</v>，算法用相減相乘法。<n>算法見陳久金<v>符天曆研究</v>。</n>劉義叟見到<v>調元</v>原文，其<v>長曆</v>可信<n>見邱靖嘉<v>遼史曆象志溯源</v>，<v>中華文史論叢</v>2012 第 4 期</n>，那麼接下來的工作就是以我復原的核對<v>長曆</v>。</p><p><v>遼志下</v>的這段記載比較胡扯：</p><blockquote><p>遼、漢、周、宋，俱行夏時，各自爲曆。國史閏朔，頗有異同。遼初用乙未元曆，本何承天元嘉曆法；後用大明曆，本祖冲之甲子元曆法。承天日食晦朏，一章必七閏；冲之日食必朔，或四年一閏。用乙未曆，漢、周多同；用大明曆，則間與宋異。國史敍事，甲子不殊，閏朔多異，以此故也。耶律儼紀以大明法追正乙未月朔，又與陳大任紀時或牴牾。</p></blockquote><p>遼金的曆法和<v>元嘉</v>、<v>祖沖之</v>風馬牛不相及。</p><p><v>疇人傳宋二姚舜輔</v>：</p><blockquote><p>有司以<v>觀天</v>推崇寧二年<n>1103</n>十一月朔爲丙子。頒秝之後，始悟其朔當進而失進，遂造<v>占天術</v>，改十一月朔爲丁丑，而再頒秝焉。其法上元甲子距崇寧二年癸未，積二千五百五十萬一千七百五十九，日法二萬二千八十。</p></blockquote><p>從這段描述可知，<v>占天</v>應該跟<v>觀天</v>一模一樣。我算出來<v>觀天</v>丙子 7420 不進朔，<v>占天</v> 7461 亦不當進朔。十一月在秋分至春分，進朔標準應該是 7500，這個積年是有問題的。在觀天基礎上將平朔加一刻重新算上元積年。</p><p><v>淳祐</v>、<v>會天</v>歲實、上元積年改用曲安京引用的參數。根據<v>寶祐四年會天曆</v>，1256 年年中冬至當爲癸丑 0.25—0.26 之間。歲實、上元積年改用曲安京引用的參數。1250 年<v>開禧</v>轉 15.5498 交 23.8590，<v>成天</v>轉 15.4620 交 23.7932，範圍兩者之間。</p><p><v>楊級大明</v>用 1180 年<v>重修大明</v>轉 19.0981 交 9.1719。</p><p><v>乙未</v>上元積年、歲差用曲安京復原成果，其餘參數根據重修大明 1180 年轉 19.0981 交 9.1719 算得。</p><p>六部太乙曆：秦漢時期的<v>甲寅太乙</v>，南北朝的<v>宋琨太乙</v>，唐代王希明的<v>開元太乙</v>，宋代的<v>景祐太乙</v>，金張行簡的<v>太乙</v>，元曉山老人的<v>太乙統宗寶鑑曆</v>。根據曲安京<v>曆法</v>第七章補。</p><h4>天文計算</h4><p>很多曆法的天文計算闕如，我用相鄰曆法來補：</p><h5>月離</h5><ul><li><strong>乾象</strong> 黃初</li><li><strong>景初</strong> 劉智、王朔之、三紀</li><li><strong>正光</strong> 玄始</li><li><strong>天保</strong> 甲寅、天和、大象<n>大象、張賔曆自成一系，不當用天保補。</n>、開皇</li><li><strong>大明</strong> 梁武</li></ul><h5>躔離</h5><ul><li><strong>大業</strong> 張孟賔、劉孝孫</li><li><strong>麟德</strong> 神龍</li><li><strong>大衍</strong> 至德</li><li>欽天：月離用五紀、紀元二曆平均<n>因爲再近一些的都是遠地點入轉了，而欽天是近地點入轉</n>，並用 9 段 248 限法重造月離表。日躔用崇玄。</li><li><strong>乾元</strong> 至道</li><li><strong>崇天</strong> 乾興</li><li>奉元、占天：日躔用崇天、紀元二曆平均，月離用崇天、觀天二曆平均</li><li>淳祐、會天：用統天、開禧、成天三曆平均</li><li><strong>紀元</strong> 楊級大明</li><li><strong>重修大明</strong> 乙未、庚午</li></ul><h5>夜漏、晷長、日緯</h5><ul><li><strong>四分</strong> 顓頊、太初、乾象、黃初、景初、劉智、王朔之、三紀、玄始、正光、興和、天保、甲寅、天和、大象、開皇</li><li><strong>麟德</strong> 神龍</li><li><strong>大衍</strong> 五紀、正元</li><li><strong>崇玄</strong> 欽天日躔表有赤道內外度，但日躔月曆表均無傳，只能用崇玄代。日食黃道內外差需要用赤道內外分。</li><li><strong>觀天</strong> 奉元、占天</li><li><strong>重修大明</strong> 乙未、庚午</li></ul><h5>夜漏</h5><ul><li><strong>大明</strong> 梁武</li><li><strong>皇極</strong> 張孟賔、劉孝孫</li></ul><h5>晷長</h5><ul><li><strong>大明</strong> 梁武、大業、戊寅、張孟賔、劉孝孫、皇極</li></ul><h5>日緯</h5><ul><li><strong>四分</strong> 元嘉、大明、梁武、大業、戊寅、張孟賔、劉孝孫、皇極</li><li><strong>應天</strong> 乾元</li></ul><h5>月緯</h5><ul><li><strong>乾象</strong> 黃初、景初、劉智、王朔之、三紀、玄始、正光、興和、天保、甲寅、天和、大象、開皇</li><li><strong>大明</strong> 梁武、大業、戊寅</li><li><strong>皇極</strong> 張孟賔、劉孝孫</li><li><strong>麟德</strong> 神龍</li></ul><h3>Todo list</h3><h4>核心</h4><ul><li>九道術、授時黃白轉換尙不可靠。天文曆的月亮位置也有問題。</li><li>MoonTcorrTable1或許要分段求MoonDifAccum1，以後再說。</li><li>欽天曆求月離入轉，要先加上太陽改正，以後再看其他曆是否需要。</li><li>遙遙無期的五星計算</li><li>唐曆月離的第二遍修正<n>影響很小，最多 5/10000 日</n></li><li>增加黃道過宮<n>不重要</n></li><li>細化曆書的日神<n>不重要</n></li></ul><h4>前端</h4><ul><li>雙語支持</li><li>新的曆法選擇框</li></ul><h4>Known Issues</h4><ul><li>朔閏表725年麟德節氣沒有宿度。</li><li>日月食計算應該還有一些小問題：<v>應天</v>怪怪的。</li><li><v>劉孝孫</v>入交不對。<v>觀天</v>入交不對，重新擬了一個交點月，暫時糊弄過去。</li><li><v>五紀</v>、<v>正元</v>月緯的比例沒找到，只能先暫時瞎填一個湊數。</li></ul><h2>朔閏表說明</h2><ol><li>可多選曆法；1 爲公元 1 年，0 爲公元前 1 年，-1 爲公元前 2 年；若僅需計算一年，在任意一框輸入年份卽可。一曆一年爲 1 單位，最多可展示 400 單位的朔閏表，若超過 400 會自動下載到本地。</li><li>本工具的另一個獨家技術是「算三年以求一年」：秦漢以後置閏採用無中氣置閏法，如果閏月在十二或一月，在特殊情況下閏年會推後或提前一年，因此欲求一年，需同時算前後一年，以應對特殊情況。這也就意味著，如果想算 10 年的朔閏，需要算 30 年。鑒於此，我們採用滾動數組，將之前的運算結果存儲下來，算 10 年朔閏只需要算 12 年，經測試，這能減少近一半的計算時間。</li><li>判斷大小月的方法：看天干是否相同。如一、二、三月的朔分別是辛亥、辛巳、庚戌，辛亥、辛巳天干一樣，說明一月有 30 日，爲大月；辛巳、庚戌天干不同，說明二月有 29 日，爲小月。</li><li>「平朔」卽未考慮日月速度變化而得出的朔日，「平氣」卽未考慮日速度變化而得出的中氣日，「定朔」卽加上日月速度改正而得出的朔日，「定氣」卽加上日速度改正而得出的中氣日。干支下的數字爲小分，均爲十進制小數，如「8184」卽 0.8184，換算成 24 小時制爲：0.8184 × 24 = 19.6416，0.6416 × 60 = 38.496，0.496 × 60 ≒ 30，卽 19 點 38 分 30 秒。小分到取小數點後四位，卽精度爲 8.64 s。各曆均有不同的辰法，需要您手動進行轉換。</li><li>「二次」表示用二次差內插法計算出的小分，「一次」表示用線性內插法計算出的小分，「三次」表示用三次差公式計算出的小分，西曆「諸曆」爲今日次日日月位置的線性內插，「交食」爲迭代法。若某曆有二次差定朔計算，則望干支及小餘爲二次差定望。</li><li>雖然漢末<v>乾象曆</v>便出現了定朔推步，但直到唐初<v>麟德曆</v>纔正式開始用定朔編排曆書，此前都是平朔注曆，定朔僅用於交食推步。雖然隋劉焯<v>皇極曆</v> 便發明了二次差計算定朔，但編排曆書時僅採用簡單的線性內插進行計算，二次差僅用於交食推步。爲了方便，本表進朔標準是高次內插所得小分。雖然<v>皇極曆</v>開始便可以計算定氣，但直到淸<v>時憲曆</v> 纔開始用定氣編排曆書，之前都是平氣注曆。本程序在平朔注曆時代用平朔編排閏月；在定朔推曆時代用二次差編排閏月、進朔，若遇一次差與二次差存在臨界差異，用戶大可進行手動調整<n>666 年二月麟德就出現了線性、二次改正分屬兩天的極端情況</n>。</li><li><v>元嘉</v>規定若月食發生在黎明之前，則屬上日，我把此規定用於所有的魏晉系曆法。干支減去 1 的，在定朔干支一格加上 <span class='NewmPlus'>-</span>，小分不變。<v>麟德</v>至<v>授時</v>之前行進朔法，我目前暫時簡單將 0.75 作爲進朔標準，進朔的月在干支後加上 <span class='NewmPlus'>+</span> 來表示，僅將干支加 1，小分不變。如「乙丑+」表示原本的干支是甲子，進朔爲乙丑，而小分與進朔前一致。如果遇到與文獻不一致的情況，用戶可根據小分自行調整進朔與置閏。</li><li>日食在朔，月食在望。<span class='eclipse-symbol'>● ◐ ◔</span> 分別表示全食、偏食、光影相接虧蝕微少。隋代以前的交食計算非常原始，僅能根據交食週期判斷是否可能發生日月食。<v>乾象</v>僅能計算月食所在月，<v>景初</v>能根據去交度分判斷虧蝕程度，<v>正光</v>提出食分計算方法，<v>大明</v>沒有虧食的計算，<v>大業</v>以前的魏晉南北曆法均無全食限，均無法計算日食，僅能判斷是否交會。整齊起見，我將食分、虧蝕程度一槪補全。<v>大業</v>、<v>戊寅</v>沒有計算日食持續時間的方法，我姑且用月食來補。</li><li>清代西曆均用黃道度及 360 度制。爲了保持統一，我將西曆的入宿度統一從 360 度制歸算成古度，使用時請注意區分。西曆黃道歸算到古曆黃道的問題：1、斗分位置，我採取的是平攤到每宿，不用斗分；2、西曆用黃經，古曆用極黃經（黃道截赤經度）。古曆入宿度都用當時的測量值，西曆是單獨的體系。</li></ol><h3>備忘</h3><ul><li><v>舊唐志三</v>大衍：「若俯循常儀，當察加時早晚，隨其所近而進退之，使不過三小其正月朔，若有交加時正見者，消息前後一兩月，以定大小，令虧在晦二。」<v>新唐</v>卷二八上校勘記：「錢校謂『三小』乃『二小』之譌。下文云『其正月朔有交，加時正見者，消息前後一兩月以定大小，令虧在晦、二。』其意蓋謂倘依定朔法須有三月頻小者，大衍歷爲牽就習俗計，酌減爲二月頻小，使交蝕前之月應小而大，後月之朔蝕得在前月之晦日也。若得三月頻小，則決無退爲晦蝕之事矣。」</li><li><v>晉書</v>卷一七「黃初二年六月二十九日戊辰加時未日食⋯⋯黃初以爲加辛強。」</li><li><v>新唐志一</v>：<q>「仁均曆有三大、三小，云日月之蝕，必在朔望。十九年九月後，四朔頻大。」</q><u>李淳風</u>：<q>「古曆分日起於子半。⋯⋯<u>傅仁均</u>子初爲朔」</q>。</li></ul><p><v>宋律曆十四</v>、<v>疇人傳</v><v>陳得一</v>的一段內容可以作爲兩宋之際曆法復原的參考：1193 年 12 月紹興</p><blockquote><p>南渡以後，星翁離散，<v>紀元術</v>亡。紹興二年，高宗重購得之。六月甲午，語輔臣曰：『術官推步不精，今術差一日，近得<v>紀元術</v>，自明年當改正。協時月正日，蓋非細事。』五年，日官言：『正月朔旦日食九分半，虧在辰正。』得一言：『當食八分半，虧在巳初。』其言卒驗。侍御史張致遠言：『今歲正月朔日食，太史所定不驗，得一嘗爲臣言，皆有依據。蓋患算造者不能通消息盈虛之奧、進退遲疾之分，致立朔有訛。凡定朔小餘七千五百以上者，進一日。紹興四年十二月小餘七千六百八十，太史不進，故十一月小盡；今年五月小餘七千一百八十，少三百二十，乃爲進朔，四月大盡。建炎三年定十一月三十日甲戌爲臘。<v>陰陽書</v>曰：<q>「臘者，接也。」</q>以故接新，在十二月近大寒前後戌日定之，若近大寒戌日在正月十一日，若卽用遠大寒戌日定之，庶不出十二月。如宣和五年十一月二十七日丙午大寒，後四日庚戌，雖近，緣在六年正月一日，此時以十九日戊戌爲臘。得一於歲旦日食，嘗預言之，不差釐刻。願詔<u>得一</u>改造新秝，委官專重其事，仍盡取其書，參校太史有無，以補遺闕。擇秝算子弟粗通了者，授演撰之要，庶幾日官無曠，秝法不絕。』二月丙子，詔祕書少監朱震卽祕書省監視得一改造新秝。八月秝成，震請賜名<v>統元</v>，從之。</p></blockquote><ul><li><v>跋吐鲁番文书中的两件唐历</v>說麟德 678 年閏十月，但是算出來閏十一月。</li></ul><h3>朔閏表可靠性驗證</h3><h4>一、程序</h4><p>目前完全可靠的是古四分曆，可完全替代朱桂昌<v>顓頊日曆表</v>、<v>太初日曆表</v>、<v>後漢四分日曆表</v>三部大轉頭。</p><p>與藤豔輝<v>宋代朔閏</v>頁 185 比較。+ 表示進朔</p><table><thead><tr><th>序號</th><th>日期</th><th>曆法</th><th>宋史</th><th>藤</th><th>程序</th></tr></thead><tbody><tr><td>1</td><td>1134 十二月</td><td>紀元</td><td>小餘七千六百八十，太史不進，故十一月小盡</td><td>7495</td><td>7499</td></tr><tr><td></td><td></td><td>崇天</td><td></td><td>7523</td><td>7660+</td></tr><tr><td>2</td><td>1135 五月</td><td>紀元</td><td>小餘七千一百八十，少三百二十，乃爲進朔，四月大盡</td><td>7362</td><td>7348</td></tr><tr><td></td><td></td><td>崇天</td><td></td><td>7287</td><td>7293</td></tr><tr><td>3</td><td>1167 十一月</td><td>紀元</td><td>十一月甲子朔</td><td></td><td>7506+</td></tr><tr><td></td><td></td><td>統元</td><td>當進作乙丑朔</td><td>5218/6930=7530</td><td>7544+</td></tr><tr><td>4</td><td>1174 十二月 117501</td><td>崇天</td><td>甲申朔</td><td></td><td>7450+</td></tr><tr><td></td><td></td><td>統元</td><td>甲申朔</td><td></td><td>7384</td></tr><tr><td></td><td></td><td>紀元</td><td>癸未朔</td><td></td><td>7410</td></tr><tr><td></td><td></td><td>乾道</td><td>癸未朔。約得不及進限四十二分</td><td>22371/30000=7457</td><td>7458</td></tr></tbody></table><p>按照這些敘述，似乎宋代進朔直接以 7500 爲標準。很奇怪。</p><h4>二、敦煌具注曆日</h4><p>與鄧文寬<v>敦煌天文曆法文獻輯校</v>核對，結果如下<n>版本 0.991.3</n>：</p><h6>太平真君十一、十二年<n>450—451</n>景初曆</h6><p>451 大將軍在卯，程序在子。451 年 的建除程序都錯開一日。朔閏、節氣都沒問題。，451 年二、八月紀錄了月食，沒問題。</p><h6>元和三年<n>808</n>具注曆</h6><p>只有五月到六月的完整信息，與<v>正元</v>對照，建除相合，那麼年份應該沒錯。<v>正元</v>四月壬子平朔 5479，定朔 9278，五月平朔壬午 0785，定朔 4975，六月平朔辛亥 6091，定朔 9678；該曆六月辛亥朔，五月辛巳朔，倒推四月壬子朔。可能該曆是平朔注曆，比<v>正元</v>提前了 8 刻以上。</p><h6>元和四年具注曆</h6><p>存四月戊申朔，閏四月丁丑朔，五月丙午朔，六月丙子朔，七月乙巳朔。<v>正元</v>閏三月丁未朔 9599，四月丙子朔 6279，五月丙午朔 2284，六月乙亥朔 7683。如果用進朔，則四月戊申比<v>正元</v>推遲 75 刻以上，五月丙午比<v>正元</v>推遲 55 刻以下，衝突了。</p><p>月神、吉時、建除、甲子納音相合。五月十六日辛酉血忌，程序沒有。</p><h6>元和十四年<n>819</n>具注曆</h6><p>五月丁丑朔，六月丁未朔，七月丙子朔。<v>正元</v>五月戊寅 1198，六月丁未 7264，七月丁丑 3589。若用進朔，該曆比<v>正元</v>提前 60 刻以上，若不用，提前 36 刻以上。</p><p>建除相合。</p><h6>長慶元年<n>821</n>具注曆</h6><p>二月戊辰，三月丁酉，四月丁卯，五月丙申，與<v>朔閏表</v>合。<v>正元</v>基本上沒問題，四月丙寅 7805，不進朔。</p><p>建除程序提前了一日</p><h6>大和三年<n>829</n>具注曆</h6><p>十一月丁丑，十二月丙午，正月丙子。<v>宣明</v>829 十一月丁丑 5228，十二月丁未 1522，830 正月丙子 6939。若進朔，則該曆比<v>宣明</v>提前 40 刻以上，若不進朔，提前 16 刻以上。</p><h6>大和八年<n>834</n>具注曆</h6><p>頁 141。有比較全面的宜忌指南。正月壬子，二月壬午，三月壬子，四月辛巳，五月辛亥，六月庚辰，七月庚戌，八月己卯，九月己酉，十月戊寅，十一月戊申，十二月丁丑。<v>宣明</v>正月壬子進朔癸丑 8330，四月辛巳進朔壬午 8383，十一月丁未 7204 不進朔。若按正、四月，該曆比<v>宣明</v>提前 10 刻以上，若按十一月，比宣明推遲 3 刻以上，互相衝突。氣、候與<v>宣明</v>相合。</p><p>歲神相合。建除程序錯開一日。</p><p>值得注意的是，該曆三月廿九庚辰是沒日，<v>宣明</v>沒在二月五日丙戌、四月十五日丙申。庚辰距冬至 145.04—146.04 日之間，那麼冬至後第一個沒日在 5.85—6.85 日⋯⋯以後可以復原一下。</p><h6>乾符四年<n>877</n>具注曆</h6><p>一般認爲該曆以<v>宣明</v>爲基礎，我算得該曆朔閏與<v>宣明</v>全合，其中六月庚午 7468 進朔庚午，十二月丁卯 7358 不進朔，均相合。建除、九宮、氣、候均相合。</p><h6>⋯⋯</h6><p>其他的以後再核對，太多了。</p><h4>三、《金石與唐代曆日》</h4><blockquote><p>@ <a href="https://book.douban.com/subject/10777480/">方中</a>，2021-05-19：应与《唐代的历》配合使用，后者作者虽然也搜集了大量资料，但只提供了历表。本书则列出了搜集的各种历日材料，金石资料丰富，但传世文献只利用了两唐书、《资治通鉴》和《唐会要》。另外作者有对材料与历表不合的地方作出论述，但有些判断是错误的。如开明元年（唐武德二年）五月，有两条材料是己巳朔，而历表是戊辰朔，作者虽然也指出材料用的是大郑年号，却就此判断历表算错，而不考虑使用历法不同。此时唐历首用定朔，与以前的平朔历法大不相同。而郑四月才立，并由隋禅位而得，宜考虑未暇创制新历，沿用隋正朔。依隋大业历算得五月己巳朔，与材料合。同理开明二年九月辛酉朔不合唐历，但合大业历。</p></blockquote><p>618 用大業平朔</p><p>619 武德二年開始用戊寅定朔</p><p>623 三月丁丑，沒有石刻資料，是朔閏表的。程序：平朔丁丑 0405，定朔丙子 9671。</p><p>625 五月甲午，沒有石刻資料。程序：平朔甲午 3668，定朔癸巳 9716</p><p>636 七月己丑，有墓誌。程序：平朔己丑 5897，定朔戊子 9961。如果不改，就是三連小</p><p>637 八月癸丑，是新疆墓誌，有可能和中原不一樣。程序：平朔癸丑 4875，定朔壬子 9284</p><p>640 十一月甲子，材料很多，都是甲子。平朔甲子 2422，定朔癸亥 9667</p><p>643 十二月丁未，墓誌丙午。程序：平朔丙午 4050，定朔丙午 8210</p><p>645 開始用戊寅平朔。</p><p>665 麟德二年依然是戊寅平朔</p><p>666 開始用麟德</p><p>669 七月丁丑，沒有資料。程序：平朔戊寅 0597，定朔戊寅 0291</p><p>682 九月庚寅，有墓誌。程序：定朔辛卯 0062。</p><p>十二月己未，幾個墓誌都是庚申朔。程序：定朔庚申 0064</p><p>683 十月甲寅，沒有資料。程序：定朔乙卯 0043</p><p>684 正月甲申，兩方墓誌、舊唐甲申，新唐癸未。程序：定朔癸未 8136</p><p>690 改建正</p><p>693 十二月丙辰，沒有資料。程序：定朔乙卯 9776</p><p>697 閏十月甲午。程序：十一月癸巳，閏十二月。</p><p>十一月甲子。程序：癸亥 6746。問題很多。</p><p>698 十月丁亥，墓誌戊子。程序：戊子 0093</p><p>703 十二月戊午，墓誌丁巳。程序：丁巳 9597</p><h4>四、朔閏表工具書</h4><p>此前已經核對過四分曆法，應該完全可靠。從<v>乾象</v>開始，與<v>中國史曆日和中西曆日對照表</v><n>方詩銘、方小芬編著，上海人民出版社 2007。下簡稱<v>方表</v> 。@澤哥</n>相核對，紀錄如下<n>已下是版本 0.991 的情況，用二次內插定朔、二次內插計算日出分</n>：</p><h5>魏晉南北</h5><p><v>戊寅</v>以前平朔注曆。<v>乾象</v>、<v>景初</v>、<v>玄始</v>、<v>正光</v>、<v>天和</v>、<v>大象</v>、<v>開皇</v>、<v>大業</v>全合。</p><ul><li>502 <v>元嘉</v>閏五月戊午，跟<v>輯要</v><v>朔閏考</v>一樣，但是<v>方表</v>是四月戊子閏</li><li>559 <v>天保</v>閏四月丁亥；<v>大明</v>、<v>梁武大同</v>閏五月丁巳</li><li>562 三曆不同閏，<v>梁武大同</v>跟北周閏一月相合</li><li>563 八月癸巳，<v>梁武大同</v>相合，<v>大明</v>、<v>天保</v>是壬辰</li><li>564 <v>梁武大同</v>閏九月丙戌，我是閏十月，不合。<v>天保</v>閏九，與<v>目錄</v>、<v>輯要</v>、<v>朔閏考</v>、<v>對照表</v>相合。</li></ul><h5>唐</h5><h6>戊寅</h6><p>645 以前用戊寅定朔，之後用戊寅平朔。</p><ul><li>623 程序三月丙子，<v>方表</v>丁丑</li><li>625 程序五月癸巳，<v>方表</v>甲午</li><li>635 程序四月丙申，<v>方表</v>丁酉，這在臨界點</li><li>637 程序八月壬子，<v>方表</v>癸丑，<v>目錄</v>壬子。如果是壬子就是三連小</li><li>640 程序十一月癸亥，<v>方表</v>甲子</li><li>642 程序、<v>目錄</v>二月丙戌，<v>方表</v>丁亥。程序四月乙酉，<v>方表</v>丙戌</li><li>643 程序十二月平朔定朔都是丙午，<v>方表</v>丁未</li><li>644 程序三月平定都是甲戌，<v>方表</v>乙亥，<v>目錄</v>甲戌</li><li>665 年比較奇怪，<v>方表</v>用的戊寅平朔，但似乎應該開始用麟德了</li></ul><h6>麟德</h6><p><v>麟德</v>開始用定朔注曆，用進朔法，但觀<v>方表</v>，<v>麟德</v>、<v>大衍</v>都只是偶爾進朔，可能一年有一次，找不到什麼規律，<v>五紀</v>開始纔形成了比較規則的進朔規則。因此我以不進朔的麟德與<v>方表</v>相參照。</p><p>665 年到底用戊寅還是麟德？該年麟德定朔閏三月，戊寅平朔閏四月，李善蘭說當年用的麟德，為了避免四月日食而改成閏三月，汪曰楨說當年仍用戊寅。（黃一農《中國史曆表朔閏訂正舉隅》）程序算得麟德四月日食分 1.35。</p><ul><li>682 程序十二月庚申，<v>方表</v>己未，位於臨界點，似乎是<v>方表</v>錯了</li><li>684 程序正月癸未，<v>方表</v>甲申，進朔或平朔就是甲申</li><li>693 程序十二月乙卯，<v>方表</v>丙辰，進朔或平朔就是丙辰</li><li>697<v>方表</v>都進朔了，因此閏月也不一樣</li><li>698 十月<v>方表</v>丁亥，可是不管平朔定朔都是戊子，<v>方表</v>肯定錯了</li><li>703 十二月程序丁巳，<v>方表</v>戊午，進朔就是戊午</li><li>708 閏月進朔，其餘兩個月不進朔</li><li>709 有兩個月進朔，兩個月不進朔</li><li>710 全部進朔</li><li>711 閏六月、十一月不進朔</li><li>712 四月不進朔</li><li>713 二、九月不進朔</li><li>714 六、九月不進朔</li><li>715 九月不進朔，這樣就是三連大</li><li>716 除了閏十二月都進朔了，只是<v>方表</v>是閏十二不進，<v>輯要</v>、<v>朔閏考</v>、<v>總譜</v>、<v>對照表</v>都進朔</li><li>717 都不進</li><li>718 有兩個月進朔</li><li>719 都不進，但正月辛卯，而算出來平定朔都是庚寅，不進朔</li><li>720 都不進</li><li>721 只有六月進朔</li><li>722 只有閏五月進朔</li><li>723 全部進朔</li><li>724 只有八月戊子進朔。<v>方表</v>閏月在 724 閏十二，但程序 725 閏正，應該是<v>方表</v>出錯了。如果 724 閏十二月，下個中氣甲申就在丙戌之前了。一定是沒有用我的算三年以求一年之法。</li><li>725 全部進朔</li><li>726 七月不進朔</li><li>727 三月不進朔</li><li>728 都不進朔</li></ul><h6>大衍</h6><ul><li>729 只有二月進朔</li><li>730 都不進朔，因此閏月也不一樣</li><li>731 都不進朔</li><li>732 都不進朔</li><li>733 十月不進朔，其餘兩個進朔</li><li>734 只有正月進朔</li><li>735 都不進朔</li><li>736 都不進朔</li><li>737 只有八月進朔</li><li>738 七月、閏八月進朔，其餘不進</li><li>739 都不進</li><li>740 都不進</li><li>741 全都進</li><li>742 全都進</li><li>743 正月不進</li><li>744 全都進</li><li>745 全都進</li><li>746 正月不進</li><li>747 八月不進</li><li>748 十一月不進</li><li>749 正、八、十一月不進</li><li>750 正月不進</li><li>751 全都進</li><li>752 三、五、十二月不進</li><li>753 六、十二月不進</li><li>754 七月不進</li><li>755 二、五、七月不進</li><li>756 沒有一個需要進朔</li><li>757 十二月不進</li><li>758 都進朔</li><li>759 都進朔</li><li>760 全都進。估計<v>方表</v>也是用大衍來排，沒用至德。</li><li>761 二月不進</li></ul><h6>五紀</h6><ul><li>762 都進朔</li><li>763 六月壬申 8658<v>方表</v>進朔，程序不進</li><li>764 二月戊辰 8199<v>方表</v>進朔，程序不進</li><li>765 五月辛卯 8656<v>方表</v>進朔，程序不進</li><li>769 三連小，<v>方表</v>也沒調整進朔</li><li>770 八月庚寅 8146，<v>方表</v>進朔，程序不進</li><li>771 二月戊子<v>方表</v>不進朔，避免了四連大</li><li>774 正月不進，程序進。六月戊辰 9143<v>方表</v>進朔，程序不進</li><li>775 二月甲子 8546<v>方表</v>進朔，程序不進</li><li>778 七月甲辰 8251、九月癸卯 8283<v>方表</v>進朔，程序不進</li><li>779 正月壬寅 8610 程序進朔，<v>方表</v>不進。九月丁卯 7047<v>方表</v>進朔，程序不進，怎麼都不應該進</li><li>781 九月丙辰 8899 程序進朔，<v>方表</v>不進</li></ul><h6>正元</h6><ul><li>786 八月戊午 8961 程序進朔，<v>方表</v>不進</li><li>787 四月甲寅 8834<v>方表</v>進朔，程序不進</li><li>791 五月庚申 9572 程序進朔，<v>方表</v>不進</li><li>793 七月丁丑 9527 程序進朔，<v>方表</v>不進</li><li>795 三月戊辰 8339<v>方表</v>進朔，程序不進。十月甲子 8683 程序進朔，<v>方表</v>不進</li><li>796 三月壬辰 8800<v>方表</v>進朔，程序不進。十月戊午 8558 程序進朔，<v>方表</v>不進</li><li>797 二月丁巳 8800<v>方表</v>進朔，程序不進</li><li>803 十月戊寅 8813 程序進朔，<v>方表</v>不進</li><li>804 九月壬申 8788 程序進朔，<v>方表</v>不進</li><li>805 正月辛未 8606 程序進朔，<v>方表</v>不進</li></ul><h6>觀象<n>正元代</n></h6><ul><li>808 庚戌 7799<v>方表</v>進朔，程序不進</li><li>810 六月己巳 9055<v>方表</v>進朔，程序不進。十一月丁酉 7214<v>方表</v>進朔，程序不進</li><li>811 十二月辛酉 7868<v>方表</v>進朔，程序不進</li><li>812 正月庚申 7386<v>方表</v>進朔，程序不進。十二月乙酉 7921<v>方表</v>進朔，程序不進</li><li>813 二月甲申 8073<v>方表</v>進朔，程序不進</li><li>814 三月戊申 8088<v>方表</v>進朔，程序不進。十二月癸卯 8218<v>方表</v>進朔，程序不進</li><li>815 六月庚子 7535<v>方表</v>進朔，程序不進。九月戊辰 8165<v>方表</v>進朔，程序不進。十二月丁酉 8007<v>方表</v>進朔，程序不進</li><li>816 七月甲子 7676<v>方表</v>進朔，程序不進。十月壬辰 8145<v>方表</v>進朔，程序不進</li><li>817 五月己丑 8824<v>方表</v>進朔，程序不進，閏月也不一樣</li><li>820 三月壬寅 8507<v>方表</v>進朔，程序不進。五月辛丑 8308<v>方表</v>進朔，程序不進</li><li>821 四月丙寅 7805<v>方表</v>進朔，程序不進</li></ul><h6>宣明</h6><ul><li>824 程序九月丁未，<v>方表</v>丙午，<v>目錄</v>、<v>輯要</v>、<v>朔閏考</v>、<v>方表</v>都是丁未</li><li>826 五月丁卯 7274<v>方表</v>進朔，程序不進</li><li>832 八月庚申 7488<v>方表</v>進朔，程序不進</li><li>836 六月戊戌 8720 程序進朔，<v>方表</v>不進，沒有理由不進</li><li>842 十二月庚申 9018 程序進朔，<v>方表</v>不進，沒有理由不進</li><li>845 正月戊申 7479<v>方表</v>進朔，程序不進</li><li>852 八月甲子 7967 程序進朔，<v>方表</v>不進，因此閏月也不一樣。莫名其妙</li><li>856 二月甲戌 7527 程序進朔，<v>方表</v>不進</li><li>858 六月庚寅 6988<v>方表</v>進朔，程序不進，沒有理由進朔</li><li>875 五月壬午 7354<v>方表</v>進朔，程序不進</li><li>886 九月丙子 7399<v>方表</v>進朔，程序不進</li><li>891 七月戊申 7602 程序進朔，<v>方表</v>不進</li><li>892 四月甲戌 7522 程序進朔，<v>方表</v>不進</li></ul><h6>崇玄</h6><ul><li>893 五月戊戌 7811<v>方表</v>進朔，程序不進，閏月也不一樣，照理說不進。</li><li>895 六月丙戌 7611<v>方表</v>進朔，程序不進</li><li>896 四月辛亥 8140<v>方表</v>進朔，程序不進</li><li>899 四月癸亥 7551<v>方表</v>進朔，程序不進</li><li>901 四月壬子 7632<v>方表</v>進朔，程序不進。六月庚辰 8102<v>方表</v>進朔，程序不進</li><li>902 四月丙子 8061<v>方表</v>進朔，程序不進</li><li>903 五月庚子 8105<v>方表</v>進朔，程序不進</li><li>904 五月甲子 7527<v>方表</v>進朔，程序不進</li><li>905 九月丙辰 7610<v>方表</v>進朔，程序不進</li><li>910 三月庚寅 7751<v>方表</v>進朔，程序不進</li><li>912 五月戊寅 8063<v>方表</v>進朔，程序不進</li><li>913 三月癸卯 7557<v>方表</v>進朔，程序不進</li><li>914 九月甲午 7554<v>方表</v>進朔，程序不進</li><li>919 三月戊辰 7861<v>方表</v>進朔，程序不進</li><li>921 四月丙辰 7798<v>方表</v>進朔，程序不進</li><li>924 七月丁酉 7720<v>方表</v>進朔，程序不進。九月丙申 7513</li><li>927 五月庚戌 7821。七月己酉 7190，但是怎麼都不能進</li><li>929 三月庚午 7872</li><li>932 四月壬子 8014</li><li>934 六月己巳 7577</li><li>936 五月戊子 7457。十二月乙酉 7500 程序進朔，<v>方表</v>不進</li></ul><p>從<v>方表</v>來看，937 開始就不是崇玄了。937 以後暫且不管</p><h5>五代宋</h5><h6>欽天</h6><ul><li>956 十月己未 6017<v>方表</v>進朔，程序不進，完全沒有理由進朔</li><li>958 九月戊申 5776 遼戊申，周己酉。</li><li>959 十月壬申 6936<v>方表</v>進朔，程序不進。十二月辛未 5643。周壬申，<v>方表</v>進朔，程序不進。遼辛未</li><li>960 七月戊戌 6931<v>方表</v>進朔，程序不進</li><li>961 六月壬辰 7403<v>方表</v>進朔，程序不進。九月辛酉 6633<v>方表</v>進朔，程序不進</li><li>963 七月庚戌 6755<v>方表</v>進朔，程序不進</li></ul><h6>應天</h6><ul><li>964 九月癸酉 7390<v>方表</v>進朔，程序不進</li><li>966 六月 7645 甲午程序進朔，<v>方表</v>不進</li><li>968 正月甲申 7265<v>方表</v>進朔，程序不進。四月癸丑 7733 程序進朔，<v>方表</v>不進</li><li>970 六月庚午 7331 程序進朔，<v>方表</v>不進</li><li>972 六月戊子 7635 程序進朔，<v>方表</v>不進。十二月丙戌 7120<v>方表</v>進朔，程序不進</li><li>974 五月戊申 8045 程序進朔，<v>方表</v>不進，沒有理由不進</li><li>978 十二月辛亥 7253<v>方表</v>進朔，程序不進</li><li>981 十一月甲午 7466<v>方表</v>進朔，程序不進</li><li>982 四月壬戌 7841 程序進朔，<v>方表</v>不進。十一月戊子 7413<v>方表</v>進朔，程序不進</li></ul><h6>乾元</h6><ul><li>983 閏月不對</li><li>986 二月己亥 7094<v>方表</v>進朔，程序不進。怎麼都不應該進</li><li>989 五月庚辰 7346 程序進朔，<v>方表</v>不進。</li><li>991 閏三月庚子 7506 程序進朔，<v>方表</v>不進。閏月也不一樣</li><li>994 正月癸丑 7276<v>方表</v>進朔，程序不進。四月壬午 7730 程序進朔，<v>方表</v>不進</li><li>996 七月己亥 7307 程序進朔，<v>方表</v>不進</li><li>997 十二月辛卯 7466<v>方表</v>進朔，程序不進</li></ul><h6>儀天</h6><ul><li>1001 正月癸酉 7049<v>方表</v>進朔，程序不進。十月戊戌 7248<v>方表</v>進朔，程序不進。十二月丁卯 6686<v>方表</v>進朔，程序不進，閏月也不一樣，怎麼都不應該進</li><li>1002 十月壬戌 7482<v>方表</v>進朔，程序不進</li><li>1018 十月己丑 7111<v>方表</v>進朔，程序不進，沒有理由進朔</li><li>1020 二月壬午 7295<v>方表</v>進朔，程序不進，沒有理由進朔</li><li>1021 十二月辛丑 7034<v>方表</v>進朔，程序不進，沒有理由進朔</li></ul><h6>崇天</h6><ul><li>1024 十二月甲寅 9857 程序進朔，<v>方表</v>不進，無論如何都應該進</li><li>1027 正月壬寅 7757 程序進朔，<v>方表</v>不進，是爲了避免四連大</li><li>1031 四月丁丑 7533<v>方表</v>進朔，程序不進</li><li>1033 六月甲午 8147 程序進朔，<v>方表</v>不進</li><li>1041 八月丁丑 7649<v>方表</v>進朔，程序不進</li><li>1044 十一月戊午 7490 程序進朔，<v>方表</v>不進</li><li>1053 二月辛未 7363 程序進朔，<v>方表</v>不進</li><li>1057 四月丙午 7649<v>方表</v>進朔，程序不進</li><li>1059 四月甲子 7471<v>方表</v>進朔，程序不進</li><li>1073 十二月庚午 7372 程序進朔，<v>方表</v>不進</li></ul><h6>明天</h6><p>這三年暫時不管</p><h6>奉元<n>擬</n></h6><ul><li>1075 正月癸巳 7375<v>方表</v>進朔，程序不進</li><li>1076 五月乙卯 7478<v>方表</v>進朔，程序不進</li><li>1089 正月壬申 7764 程序進朔，<v>方表</v>不進，避免了四連大</li></ul><h6>觀天</h6><ul><li>1097 正月丙戌 7512 程序進朔，<v>方表</v>不進</li></ul><h6>占天</h6><ul><li>1103 八月丁未 7503 程序進朔，<v>方表</v>不進</li></ul><h6>紀元</h6><ul><li>1121 九月壬戌 7482 程序進朔，<v>方表</v>不進</li><li>1122 九月丙辰 7441<v>方表</v>進朔，程序不進</li></ul><h6>統元</h6><ul><li><p>1152 正月丙申 7359<v>方表</v>進朔，程序不進</p></li><li><p>統元實行期間與紀元並推：</p><blockquote><p>統元曆頒行雖久，有司不善用之，暗用紀元法推步而以統元爲名。乾道二年，日官以紀元曆推三年<n>1167</n>丁亥歲十一月甲子朔，將頒行，裴伯壽詣禮部陳統元曆法當進作乙丑朔，於是依統元曆法正之。</p></blockquote></li></ul><p>也太絕了，我算出來紀元 1167 年十一月甲子平朔 6154，線性定朔 7506，秋分到春分是 0.75 進朔，差了 0.0007，什麼毛病⋯⋯該日入轉 15.2674，距第二年冬至 2.1114。線性改正，月：<code>867 + 0.2674 (1510 - 867) = 1038.9382</code>，日 <code>385 * 2.1114 / 15.2185 = 53.4145</code>，<code>日月改正 = (-53.4145 + 1038.9382) / 7290 = 0.1352</code>，則 <code>線性定朔 = 0.6154 + 0.1352 = 0.7506</code>。呃⋯⋯和手算結果一樣，服了。有可能是 0.7506 四捨五入就是 0.75，於是不進朔了？</p><h6>乾道</h6><ul><li>1168 十月己丑<v>方表</v>戊子，但定朔在己丑</li><li>1174 五月丙戌 7454 程序進朔，<v>方表</v>不進</li><li>1176 正月定位 7640 程序進朔，<v>方表</v>不進</li></ul><h6>淳熙</h6><ul><li>1178 十月庚寅 7526<v>方表</v>進朔，程序不進</li></ul><h6>統天</h6><ul><li>1205 五月丁巳 8025 程序進朔，<v>方表</v>不進</li><li>1207 十一月壬申 7296<v>方表</v>進朔，程序不進</li></ul><h6>開禧</h6><ul><li>1209 十月辛酉 7479 程序進朔，<v>方表</v>不進</li><li>1225 三月辛酉 7522 程序進朔，<v>方表</v>不進</li><li>1248 八月乙亥 7137<v>方表</v>進朔，程序不進</li><li>1249 八月己亥 7407<v>方表</v>進朔，程序不進</li><li>1251 七月己未 5592<v>方表</v>進朔，程序不進。十一月丙戌 7520 程序進朔，<v>方表</v>不進</li></ul><h6>淳祐<n>擬</n></h6><ul><li>1252 正月乙酉 7406 <v>方表</v>進朔，程序不進</li></ul><h6>會天<n>擬</n></h6><ul><li>1256 七月己丑 7246，<v>寶祐四年會天曆</v>進朔庚寅，程序不進。按照紀元進朔規則，需要小餘 0.7375 以上</li><li>1257 七月癸丑 7059<v>方表</v>進朔，程序不進</li><li>1258 八月丁丑 7444<v>方表</v>進朔，程序不進</li><li>1261 三月壬戌 7556<v>方表</v>進朔，程序不進</li><li>1263 二月辛亥 7630 程序進朔，<v>方表</v>不進。十月戊申 0740 平定朔都在戊申，不應該是丁未。十一月丁丑 7880 程序進朔，<v>方表</v>不進</li><li>1265 六月丁卯 7046<v>方表</v>進朔，程序不進</li><li>1266 七月辛卯 7071<v>方表</v>進朔，程序不進</li><li>1267 五月丁亥 7507 程序進朔，<v>方表</v>不進</li><li>1270 閏十一丙寅 8154 程序進朔，<v>方表</v>不進</li></ul><h6>成天</h6><ul><li>1273 六月辛巳 7404 程序進朔，<v>方表</v>不進</li><li>1275 七月己巳 7221<v>方表</v>進朔，程序不進</li><li>1276 二月丙申 7600 程序進朔，<v>方表</v>不進</li></ul><h6>賈俊大明<n>995—1136</n></h6><p>根據<v>方表</v>的閏月，以<v>宣明</v>爲參考，999 年賈俊大明氣要比宣明少 0.2478 以上，996 年 0.2621 以下，1015 年要在 0.4732 以上。好吧，結論就是這些朔閏表都是胡亂排的。</p><h6>楊級大明<n>1137—1181</n></h6><ul><li>1147 三月甲子 5972<v>方表</v>進朔，程序不進。十月辛卯 7616 程序進朔，<v>方表</v>不進</li><li>1155 九月乙巳 7306<v>方表</v>進朔，程序不進</li><li>1163 八月己未 7438<v>方表</v>進朔，程序不進</li></ul><h6>重修大明<n>1181—1280</n></h6><ul><li>1205 五月丁巳 7952 程序進朔，<v>方表</v>不進</li><li>1207 五月乙亥 7598 程序進朔，<v>方表</v>不進</li><li>1209 正月乙未 7109<v>方表</v>進朔，程序不進</li><li>1248 八月乙亥 7144<v>方表</v>進朔，程序不進</li><li>1249 八月己亥 7460<v>方表</v>進朔，程序不進</li><li>1250 四月丙申 7391 程序進朔，<v>方表</v>不進</li><li>1258 八月丁丑 7491 程序進朔，<v>方表</v>不進</li><li>1266 七月辛卯 7103<v>方表</v>進朔，程序不進</li><li>1267 五月丁亥 7459 程序進朔，<v>方表</v>不進</li><li>1269 五月乙巳 7159<v>方表</v>進朔，程序不進</li><li>1273 六月辛巳 7370 程序進朔，<v>方表</v>不進</li><li>1274 六月乙巳 7086<v>方表</v>進朔，程序不進</li><li>1275 七月己巳 7325<v>方表</v>進朔，程序不進</li></ul><h4>授時大統</h4><p>一般認爲，<v>大統</v>全襲<v>授時</v>，只是取消歲實消長；用 / (月實行-日平行) 取代 / 月實行。但是據<v>大統曆書</v>，依然用的是<v>授時</v>的 / 月實行。跟大統曆書核對，我的計算分毫不差。<n>見 廖育棟 <a href="https://ytliu0.github.io/ChineseCalendar/MingCalendar_chinese.html">明朝<v>大統曆</v>的定朔計算及曆表朔日訂正</a></n></p><p>「六年六月癸亥朔日食（1302年6月26日）时在戌。依历，日食<strong>五十七秒</strong>，众以涉交既浅，且复近浊，欲匿不报。独齐履谦以状闻。及其时，果食。」《元史·传五十九》。我用授時通軌算，分0.57虧78.86甚80.61復82.36。</p><h4>五、時憲曆</h4><p>時憲曆注曆所用朔望節氣是本日次日夜半日月位置線性內插而得，交食所用朔望，癸卯元曆是在注曆朔望（實朔泛時）的基礎上迭代一次（實時），之前的曆法則是重算實引。癸卯元求泛時是只固定用平朔望今明兩天，而甲子元則是選用定朔望今明兩天，此處我統一用甲子元的辦法。注曆所用時刻皆為視時。</p><p>注曆定朔誤差：西洋新法、永年表大部分0–2分鐘，少量3–5，另有一些異常值；甲子元曆大部分0–1，少量2；癸卯元曆0–1。</p><p>節氣誤差：甲子、癸卯基本上一分不差，新法、永年相差0–2。新法多出來的誤差是由於公式與日躔表不能完全相合。</p><h4>新法曆書、康熙永年表</h4><p>新法曆書和永年表的合朔時刻實在很奇怪，看了好幾個年份，都是一至四月密合，五至七月誤差增大至一刻鐘，八至十二月下降至九分鐘左右。猜想是時差的問題，於是刪掉時差，發現誤差曲線類似一個sin函數，推測可能合朔的時差只考慮了升度差，未考慮均數差。現將僅考慮了升度差之後的誤差合排如下（單位分鐘。「?」表示看不清或缺頁，「*」表示異常值）：</p><table><thead><tr><th></th><th>正</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>七</th><th>八</th><th>九</th><th>十</th><th>十一</th><th>十二</th></tr></thead><tbody><tr><td>1646</td><td>-1</td><td>-2</td><td>-2</td><td>+1</td><td>+4</td><td>+3</td><td>-22*</td><td>-3</td><td>-1</td><td>2h*</td><td>1h*</td><td>+13*</td></tr><tr><td>1658</td><td>-1</td><td>-1</td><td>+4?</td><td>+2</td><td>+1</td><td>-1</td><td>?</td><td>0</td><td>0</td><td>+5?</td><td>+1</td><td>+1</td></tr><tr><td>1676</td><td>?</td><td>-1</td><td>+1</td><td>+1</td><td>0</td><td>-1</td><td>0</td><td>?</td><td>+3</td><td>+2</td><td>-1</td><td>+1</td></tr><tr><td>1679</td><td>-1</td><td>+1</td><td>0</td><td>-3</td><td>-2</td><td>0</td><td>+1</td><td>+1</td><td>0</td><td>-3</td><td>-2</td><td>+1</td></tr><tr><td>1714</td><td>-1</td><td>+2</td><td>+2</td><td>+2</td><td>0</td><td>+2</td><td>+1</td><td>+1</td><td>+1</td><td>+2</td><td>-1</td><td>0</td></tr><tr><td>1722</td><td>-2</td><td>-2</td><td>0</td><td>+1</td><td>0</td><td>-1</td><td>-1</td><td>0</td><td>+1</td><td>+16*</td><td>0</td><td>-1</td></tr></tbody></table><p>但節氣時刻則用了完整的日差表。為何節氣和合朔要用不同的時差呢？</p><h4>曆象考成</h4><p>1733年：</p><table><thead><tr><th></th><th>正</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>七</th><th>八</th><th>九</th><th>十</th><th>十一</th><th>十二</th></tr></thead><tbody><tr><td>曆書</td><td>亥初三刻三分</td><td>辰正一刻三分</td><td>酉初初刻十二分</td><td>丑初初刻八分</td><td>辰正三刻四分</td><td>酉初初刻八分</td><td>丑正三刻十四分</td><td>申初一刻八分</td><td>卯正二刻十二分</td><td>子正二刻十二分</td><td>戌正初刻一分</td><td>未正二刻七分</td></tr><tr><td>本站</td><td>-1</td><td>-1</td><td>0</td><td>-1</td><td>+1</td><td>-1</td><td>-1</td><td>-1</td><td>0</td><td>0</td><td>-2</td><td>-1</td></tr></tbody></table><h4>曆象考成後編</h4><p>《後編》有1730年六月日食算例，初虧時間是0.4626，我算出來0.4623，只相差半分鐘。</p><p>以1762年爲例：</p><table><thead><tr><th></th><th>曆書</th><th>廖育棟節氣和月相時刻</th><th>廖育棟日月位置</th><th>本站</th><th></th></tr></thead><tbody><tr><td>四月甲子4-24</td><td>13:22 未初一刻七分</td><td>13:23 未初一刻八分</td><td>13:26:55 日月33°58&#39;06&quot;</td><td>未初一刻七分五十四秒</td><td></td></tr><tr><td>五月甲午5-24</td><td>00:29 子正一刻十四分</td><td>00:30 子正二刻</td><td>00:30:01 日月62°24&#39;13&quot;</td><td>子正一刻十四分四十四秒</td><td></td></tr><tr><td>閏五月癸亥6-22</td><td>09:01 巳初初刻一分</td><td>09:01 巳初初刻一分</td><td>09:04:35 日月90°27&#39;59&quot;</td><td>巳初初刻一分二十八秒</td><td></td></tr></tbody></table><h4>總結</h4><p>對於一般文史研究者，在我研究出什麼之前，正常情況下直接看工具書好了，不要用我這個。在<v>紀元</v>以前，程序算出來的跟工具書上的差異太大了，這些差異基本上都是進朔引起的，<v>授時</v>取消進朔，便與實行曆書分毫不差。不知道工具書是怎麼算的，不知道工具書跟當時的實行曆書有多大差異，以後都要慢慢研究。</p><ul><li>撲朔迷離的<v>麟德</v>、<v>大衍</v>進朔。我實在沒看出有什麼規律，留待以後慢慢研究。</li><li>撲朔迷離的<v>戊寅</v>定朔，與<v>方表</v>不合，可能的原因是注曆沒有算日躔改正？</li><li><v>正元</v>感覺是個系統性問題，九十月進而不進，三月不進而進，要重新考慮<v>正元</v>、<v>五紀</v>進朔規則。</li></ul><p>進朔差異原因分析：</p><ol><li>確定的是，出現四連大就會手動調整，程序沒法調。但好像不太顧忌三連小。</li><li>大衍故意把日食放在晦二，宋曆很多有日食則不進朔，我暫時沒考慮日食。</li><li>上面備忘那段材料：「今年五月小餘七千一百八十，少三百二十，乃爲進朔」，說明編曆人員的疏忽也是很有可能的事。</li><li>天知道。</li></ol><p><v>中國古代曆法</v>頁 570 將根據術文計算的<v>宣明</v>曆譜與工具書進行比較，結果是：</p><blockquote><p>與<v>歷代長術輯要</v>比較，878 個月朔中有 11 個不同，都發生在進朔的邊緣狀態。11 個中有 7 個我們的計算結果與<v>資治通鑑</v>所收劉義叟的<v>長曆</v><n>簡稱<v>目錄</v></n>相同，4 個不同。⋯⋯三家曆譜有一定差異⋯⋯有待進一步考察。</p></blockquote><h2>具注曆說明</h2><p>〔天文曆說明見「天文」模塊〕曆書按月提供全年每一日的信息，中間彩色爲天文曆部分，其餘爲具注曆部分。</p><h3>備忘</h3><ul><li><p>孔慶典、江曉原<v>七元甲子術研究</v>：</p><blockquote><p>该文内容为一个名为康遵的术士在开宝七年<n>974 年</n>为一位生于庚寅年丙戌月己巳日<n>卽 930 年 10 月 3 日</n>的人算命。注意到在文首中，庚寅年丙戌月己巳日标为「房日」</p></blockquote></li></ul><p><code>% 60.1</code> 再取整是為了保留 60，如果直接 <code>%60</code>就會變成 0。</p><h3>可靠性驗證</h3><h4>授時曆</h4><p>與《授時曆故》1599年算例（《黃宗羲全集》18冊，2012，p304）相較，「推四正夜半黃道宿次」，春分密合，其餘幾個區別都很小。</p><h2>現代曆表說明</h2><h3>朔閏表</h3><p>此處提供現代天文學朔閏表，採用的模型是：DE441（-2499–1599）440（1600–2499）曆表、Vondrak 等歲差模型、IAU2000A 章動模型、Stephenson, Morrison 等 ΔT 公式。</p><h4>步驟</h4><ol><li>使用各種曆表算出某天體相對於目標天體的ICRS（國際天球參考係）座標 $I_{ICRS}=[x, y, z]$，單位爲 km。</li><li>使用frame bias matrix（參考架偏差矩陣）將ICRS座標係轉換爲赤道座標係 $I_{2000}=BI_{ICRS}$</li><li>計算歲差矩陣 $P$</li><li>計算章動矩陣 $N$</li><li>赤道座標爲 $I_{eq}=NPI_{2000}$</li><li>使用旋轉矩陣轉換爲黃道座標 $I_{ec}=R_1(ε)I_{eq}$</li><li>迭代計算合朔、節氣時刻的 TDB</li><li>計算 $ΔT$，得出 $UT1=TT-ΔT≈TDB-ΔT$</li></ol><p>需要注意，ELP2000、VSOP87 的座標是黃道，而非 DE 曆表的赤道。所以第 5 步變成了：</p><ol start="5"><li>赤道座標爲 $I_{eq}=NPR_1(-ε)I_{2000}$</li></ol><p><strong>不能</strong>這樣：</p><ol start="5"><li>黃道座標爲 $I_{ec}=NPI_{2000}$</li><li>赤道座標爲 $I_{eq}=R_1(-ε)I_{ec}$</li></ol><h4>一些備忘</h4><ul><li>DE 曆表與廖育棟網站上的系統誤差是 ΔT 算法造成的（他似乎用的《月相》較老的，我用了他 <em>Star Charts</em> 所說的較新的），時間一長，相差能有三分鐘。$ΔT=TT-UT1$ 受到地球自轉速度變動影響，這在計算古代日食時是主要誤差，影響遠大於曆表的誤差。</li><li>本站用 DE440/1 編算的朔閏表是目前最精確的朔閏表，忽略光行時光行差的近似誤差、TDB 到 TT 的近似誤差，可以精確到 0.01 秒。使用 ELP2000、VSOP87 半分析曆表計算合朔，公元前 1000 年的誤差在一分半鐘以內，公元 2000 年誤差在一秒以內。</li><li>半分析曆表計算 100 年朔閏大約用時 23 秒。DE440/1 曆表的朔望節氣時刻已在本地算出，網頁端的工作是編排朔閏。python 計算 11000 個節氣時刻用 450秒。</li></ul><h4>農曆編排</h4><p>GB/T 33661-2017《农历的编算和颁行》第四節《農曆的編排規則》有五條：</p><ol><li>以北京时间为标准时间。</li><li>朔日为农历月的第一个农历日。</li><li>包含节气冬至在内的农历月为农历十一月。</li><li>若从某个农历十一月开始到下一个农历十一月（不含）之间有13 个农历月，则需要置闰。置闰规则为：取其中最先出现的一个不包含中气的农历月为农历闰月。</li><li>农历十一月之后第2个（不计闰月）农历月为农历年的起始月。</li></ol><h3>年曆</h3><p>由完整的VSOP87、ELP2000曆表算出。提供的是視位置。</p><h3>Acknowledgement</h3><table><thead><tr><th></th><th>模型</th><th>代碼來源</th></tr></thead><tbody><tr><td>總體方法</td><td>廖育棟</td><td>《<a href="https://ytliu0.github.io/ChineseCalendar/computation_simp.html">月相和二十四節氣的計算</a>》、<em><a href="https://ytliu0.github.io/starCharts/">Calculations in Star Charts</a></em></td></tr><tr><td>行星曆表</td><td>VSOP87A</td><td><a href="https://vsr83.github.io/orbits.js/">orbit.js</a></td></tr><tr><td>月球曆表</td><td>ELP2000</td><td><a href="https://vsr83.github.io/orbits.js/">orbit.js</a></td></tr><tr><td>數值曆表</td><td>DE441/0</td><td><a href="https://pypi.org/project/jplephem/">jplephem</a></td></tr><tr><td>歲差</td><td>Vondrak 等（2011）</td><td><a href="https://github.com/dreamalligator/vondrak">Vondrak</a>，由 GPT 轉換爲 JS。代碼中保留了我自己寫的 IAU2006</td></tr><tr><td>章動</td><td><a href="http://asa.usno.navy.mil/SecM/Glossary.html#nutation">IAU2000A</a></td><td><a href="https://github.com/brandon-rhodes/python-novas">python-novas</a>/Cdist/nutation.c，由 GPT 轉換爲 JS。代碼中保留了我自己寫的 IAU2000</td></tr><tr><td>TT轉UT1</td><td>Stephenson等人（2016）及Morrison等人（2021）的擬合公式</td><td>廖育棟 <a href="https://github.com/ytliu0/DeltaT">DeltaT</a>，由 GPT 轉換爲 JS。代碼中保留了 Morrison、Stephenson（2004）的公式</td></tr></tbody></table><p>另外可參考的庫：</p><ul><li><a href="https://github.com/THRASTRO/ephem.js/">ephem.js</a> 各種各樣的 VSOP、ELP。</li><li>計算DE曆表的<a href="https://pypi.org/project/jplephem/">jplephem</a>庫，以及功能豐富的skyfield庫。</li><li><a href="http://www.moshier.net/#Cephes">Astronomy and numerical software source codes</a></li></ul><h2>同餘模塊說明</h2><p>分隔符：<code>; , ， 。 ；空格</code>；組數不限</p><h3>一次同餘式 二元一次不定方程</h3><p><code>ax - by = c</code> 等價於 <code>ax ≡ c (mod b)</code>，有解的充要條件：<code>(a,b)|c</code>，卽 c 能被 a、b 的最大公因數整除</p><h3>最大公因數 最小公倍數</h3><p>求多個整數或小數的最大公因數 gcd、最小公倍數 lcm</p><h3>分數最小公倍數</h3><p>求多組分數的最小公倍數 lcm，依次輸入各組分子、分母<n>整數分母用 1 表示。</n></p><h3>章蔀紀元法</h3><p>依次輸入斗分、歲實分母、朔餘、日法，計算相應的章法、蔀法、紀法、元法，可以用來復原一些失傳魏晉南北曆法的參數。</p><h3>上元積年算法</h3><p>古曆入元和唐宋演紀是秦九韶<v>數書九章</v>的兩個命題。秦九韶也試圖通過大衍總數術算上元積年，但並不如意，因爲總數術缺乏對餘數的調整選擇功能。<n>曲安京<v>曆法</v>頁 29</n></p><h4>古曆入元</h4><p>依次輸入年月參數、冬至大小餘、天正經朔大小餘，大餘卽干支序數，無須 - 1。</p><p>宋以前皆有上元積年，雖有<v>戊寅</v>、<v>統天</v>的短暫停用，但直到<v>授時</v>纔徹底廢除。根據我粗畧的觀察，漢代的上元積年是回歸年、朔望月、交食週期、五星週期的同餘數，魏晉系、北系是回歸年、朔望月的同餘數，南系是回歸年、朔望月、交食週期、近點月。</p><p><v>後漢四分</v>的上元積年是 270 多萬年，古六曆也是差不多是這樣，所以可以判定古六曆的上元積年一定是漢代的，戰國時期的古六曆應該沒有考慮五星週期，也沒有考慮年干支，直以 1520 年爲一週期。這只是我的猜測。</p><h4>唐宋演紀</h4><p>依次輸入斗分、日法、冬至大小餘、天正經朔大小餘，大餘卽干支序數，無須 - 1。這是秦九韶紀錄的<v>開禧曆</v>演紀方法，但其他宋曆似乎並不是這樣用求一術算的，對其他曆法並不好用。</p><h4>從零開始造唐宋曆</h4><p>第一步。暴力窮舉所有符合條件的日法。</p><p>第二步。暴力窮舉所有符合條件的上元積年，從 100 萬年窮舉到 1 億年。選取一部已知曆法作爲參照，「年」輸入參照曆法化爲小數後的歲實；「月」輸入上一步生成的日法、朔餘<n><n>選擇最接近的一箇卽可</n></n>；「冬至」輸入參照曆法年前冬至的日分<n><n>如乙丑日 0.2518 分，則是 1.2518</n></n>；「天正朔」輸入參照曆法年前天正經朔的日分。按照經驗，範圍在 0.02 之內。如計算出多個上元，則縮小範圍繼續計算。如選擇了 1256 年作爲參照，計算出 73147137，則上元爲公元 1256-73147137 年。</p><p>第三步、窮舉參數。計算恆星年、近點月、交點月等參數。以比例關係求得分子整數部分，以 0.0001 遞增，窮舉得到。「參數積日」輸入參照曆法的朔閏表該年表頭相應信息。</p><h3>備忘</h3><ul><li>授時曆議的後天，從成天和授時的關係來看，指的是冬至時刻。</li><li>關於賈俊<v>大明</v>：</li></ul><blockquote><p>「聖宗統和十二年，可汗州刺史賈俊進新曆，則大明曆是也。」遼大明曆術，<a href="https://zh.wikipedia.org/wiki/%E5%85%83%E6%9C%9D">元</a>修<v>遼史</v>時史官已不得見，因此曆象志全錄同名的南朝<a href="https://zh.wikipedia.org/wiki/%E5%88%98%E5%AE%8B">宋</a><a href="https://zh.wikipedia.org/wiki/%E7%A5%96%E6%B2%96%E4%B9%8B">祖沖之</a><a href="https://zh.wikipedia.org/wiki/%E5%A4%A7%E6%98%8E%E6%9B%86_(%E7%A5%96%E6%B2%96%E4%B9%8B)">大明曆</a> 術，以充篇幅，而兩者實不相干，爲後世史家所非議[<a href="https://zh.wikipedia.org/zh-hant/%E5%A4%A7%E6%98%8E%E6%9B%86_(%E8%B3%88%E4%BF%8A)#cite_note-1">1]</a>。但是由歷史文獻氣朔記錄推察，學者認爲遼大明曆很有可能本於唐<a href="https://zh.wikipedia.org/wiki/%E5%AE%A3%E6%98%8E%E6%9B%86">宣明曆</a>。</p><p>嚴敦傑「遼曆志疑」指出：一、<v>遼史</v>曆象志朔考謂「遼己未歲<n>1079</n>氣朔與宣明曆合。」，又云日本承曆二年戊午歲<n>1078</n>與遼曆相近，而當時日本所行用就是宣明曆。二、宣明曆曾長期流行於<a href="https://zh.wikipedia.org/wiki/%E6%B8%A4%E6%B5%B7%E5%9C%8B">渤海國</a>、<a href="https://zh.wikipedia.org/wiki/%E5%A5%B3%E7%9C%9F">女真</a>等北方民族，渤海國爲契丹所滅，因此宣明曆可能由此傳入契丹。三、嚴氏以<a href="https://zh.wikipedia.org/wiki/%E6%B1%AA%E6%9B%B0%E6%A5%A8">汪曰楨</a><v><a href="https://zh.wikipedia.org/w/index.php?title=%E6%AD%B7%E4%BB%A3%E9%95%B7%E8%A1%93%E8%BC%AF%E8%A6%81&action=edit&redlink=1">歷代長術輯要</a></v>所推氣朔與遼曆不合者 12 例，改用宣明曆驗算，結果有 11 例與遼曆相符[<a href="https://zh.wikipedia.org/zh-hant/%E5%A4%A7%E6%98%8E%E6%9B%86_(%E8%B3%88%E4%BF%8A)#cite_note-2">2]</a>。邱靖嘉更進一步補充，宋江休復<v>江幾鄰雜志</v>云：「己亥曆日十一月大盡，契丹曆此月小，十二月十四日夜纔昏月蝕，戎使言：『竊謂爲己望』。時修<v><a href="https://zh.wikipedia.org/wiki/%E6%96%B0%E5%94%90%E6%9B%B8">唐書</a></v>，問<n>劉</n><a href="https://zh.wikipedia.org/wiki/%E5%8A%89%E7%BE%B2%E5%8F%9F">羲叟</a>，云：『見用楚衍曆，差一日，宣明曆十一月當小盡。』」<a href="https://zh.wikipedia.org/wiki/%E9%99%B3%E6%BC%A2%E7%AB%A0">陳漢章</a>考證己亥爲<a href="https://zh.wikipedia.org/wiki/%E5%AE%8B%E4%BB%81%E5%AE%97">宋仁宗</a>嘉祐四年<n>1059</n>，是年十一月宋曆爲大月，遼曆爲小月，而宣明曆與遼曆同，足見遼大明曆與唐宣明曆比較接近，兩者可能存在淵源關係[<a href="https://zh.wikipedia.org/zh-hant/%E5%A4%A7%E6%98%8E%E6%9B%86_(%E8%B3%88%E4%BF%8A)#cite_note-3">3]</a>。</p></blockquote><h2>內插模塊說明</h2><h3>招差術</h3><p> <code>第一行輸入框</code> 在「數列」框中輸入一組離散値，數量 = 次數 + 1，以第一箇數爲起算點。「次數」爲進行幾次內插，卽幾次多項式。n 爲所求的數，第一箇離散値的 n 爲 1。內插公式的一般形式：f(x<sub>0</sub>+x) = f(x<sub>0</sub>) + Δ<sup>1</sup>x + Δ<sup>2</sup> 1/2! x (x-1) +...+ Δ<sup>p</sup> 1/p! x (x-1) ... (x-p+1)。初始値爲<v>大衍曆</v>晷影五次差分表</p><p> <code>第二行輸入框</code> 已知差分<n>由低次到高次排列</n>，求 y(n)。次數爲差分的箇數。第一箇數的 n 是 0，上面的是 1。</p><h3>拉格朗日內插</h3><p>數列中依次輸入各組 x, y 値。拉格朗日不等間距內插公式：y = Σ(n,1) yiLi, Li = Π(n,j=1,j≠i) (x-xj)/(xi-xj)。<v>大衍</v>不等間距內插公式應該是和拉格朗日內插等價的。</p><p><v>大衍</v>「凡推日月度及軌漏、交蝕，依定氣；注曆，依常氣」。</p><h3>晷長 ⇒ 冬夏至時刻</h3><p><v>授時曆議</v>最開始就是測影求冬至時刻，根據冬至前後數日正午的三個點，用多組測量結果平均，得到冬至時刻。祖沖之、郭守敬採用線性插值<n>左圖</n>，用如下算式求得冬至時刻：</p><pre><code class="language-javascript">const Dif1 = l1 - l3const Dif2 = l2 - l3const result = (d3 - d1 - Dif1 / Dif2) / 2 + 0.5</code></pre><p>具體推導過程見 <a href="https://www.zhihu.com/question/35894763/answer/65018958">@三种不同的红色</a>。</p><img src="https://pic.imgdb.cn/item/60c98a01844ef46bb2de3746.jpg" width='700'><p>但實際上晷長變化是一個近似二次函數<n>右圖</n>，於是我們用拉格朗日內插求極大值的方法<n>二分法</n>來求冬至時刻。祖沖之-郭守敬算法會產生兩個誤差，一個是線性插值帶來的算法誤差，另一個是測量誤差，我們的方法可以消除算法誤差，可實際上沒什麼必要，實際使用中只精確到刻，卽小數點後 2 位，算法誤差不會帶來什麼影響。況且，他們選取的點都是以二至對稱的，所以誤差其實很小。</p><p>例如，祖沖之<v>宋書曆志下</v>：</p><blockquote><p>據大明五年<n>461 年</n>十月十日，影一丈七寸七分半，十一月二十五日，一丈八寸一分太，二十六日，一丈七寸五分強，折取其中，則中天冬至，應在十一月三日。求其蚤晚，令後二日影相減，則一日差率也。倍之爲法，前二日減，以百刻乘之爲實，以法除實，得冬至加時在夜半後三十一刻，在元嘉歴後一日，天數之正也。</p></blockquote><p>線性插值算得 <code>(10.8175-10.775)/(10.8175-10.7508333) * 0.5 = 0.31874984</code>。輸入 <code>0.5,10.775,45.5,10.8175,46.5,10.7508333</code> ，算得二次內插極值 <code>f (23.321281682195) = 11.540491757111</code>，線性插值誤差爲 <code>0.00253184 = 0.253 刻</code>，完全可以接受。該年<v>大明</v>冬至乙酉 3160。</p><p>以下是<v>授時曆議</v>所有數據，日期用儒略日最後四位，卽減去 2180000，便於計算：</p><pre><code class="language-javascript">// 至元十四年&lt;n&gt;1277&lt;/n&gt;冬至7826.5,7.94855,7833.5,7.9541,7834.5,7.9455 // f (7830.337642585551) = 7.96584166366787821.5,7.86355,7838.5,7.87935,7839.5,7.855 // f (7830.330890052356) = 7.97307251655377821.5,7.86355,7838.5,7.87935,7840.5,7.83045 // f (7830.347896627651) = 7.96812022224097813.5,7.59865,7814.5,7.6377,7847.5,7.5851 // f (7830.333308480895) = 7.9373817005857803.5,7.0971,7857.5,7.076,7858.5,7.01565 // f (7830.320788807215) = 7.88131773982987670.5,1.308,7990.5,1.30385,7991.5,1.29205 // f (7830.323408937259) = 2.2459510672011// 至元十五年&lt;n&gt;1278&lt;/n&gt;夏至8008.5,1.17775,8017.5,1.178,8018.5,1.18055 // f (8012.9449339207) = 1.17276673519337856.5,7.1343,8168.5,7.07595,8169.5,7.1406 // f (8012.9514166438) = 2.06395275625447853.5,7.29725,7854.5,7.24545,7855.5,7.1909。8170.5,7.19575,8171.5,7.2505,8172.5,7.303357848.5,7.5417,7849.5,7.49595,7850.5,7.4486;8175.5,7.45205,8176.5,7.50035,8177.5,7.54495// 十五年冬至8185.5,7.83185;8205.5,7.83635,8206.5,7.80825 // f (8195.5834068844) = 7.96899033565548178.5,7.58815,8179.5,7.63015;8211.5,7.63665,8212.5,7.5953,8213.5,7.55045// 拆：8178.5,7.58815,8179.5,7.63015;8211.5,7.636658178.5,7.58815,8179.5,7.63015;8212.5,7.59538178.5,7.58815,8179.5,7.63015;8213.5,7.55045 // f (8195.5749154341) = 7.9575399678137//8174.5,7.40375;8216.5,7.412,8217.5,7.36145 // f (8195.5832219016) = 7.92832910381228045.5,1.44525,8046.5,1.4638;8345.5,1.44818017.5,1.178,8372.5,1.1863,8373.5,1.1783// 十六年&lt;n&gt;1279&lt;/n&gt;夏至8362.5,1.23695,8363.5,1.22935;8392.5,1.22648335.5,1.63905;8419.5,1.60995,8420.5,1.63118316.5,2.1305;8439.5,2.11955,8440.5,2.14865 // f (8378.1890954669) = 1.23469249020378315.5,2.1611;8440.5,2.14865,8441.5,2.19155 // f (8378.1459269389) = 0.821794816171788302.5,2.60345;8453.5,2.5899,8454.5,2.6259 // f (8378.1889697314) = 1.24324209704918287.5,3.21955;8467.5,3.15965,8468.5,3.202658274.5,3.85015;8480.5,3.7823,8481.5,3.83105// 十六年冬至8545.5,7.674;8576.5,7.658,8577.5,7.61425 // f (8560.8089908599) = 7.99064108955638539.5,7.45025;8540.5,7.4545;8541.5,7.5025。8579.5,7.532;8580.5,7.48525;8581.5,7.4365;8582.5,7.38715// 拆8539.5,7.45025;8540.5,7.4545。8579.5,7.5328539.5,7.45025;8540.5,7.4545。8580.5,7.485258539.5,7.45025;8540.5,7.4545。8581.5,7.4365 // f (8559.033810143) = 7.49284975741348539.5,7.45025;8540.5,7.4545。8582.5,7.38715 // f (8555.6101281269) = 7.4855805546617//8537.5,7.3015。8583.5,7.332;8584.5,7.28425 // f (8560.8218455321) = 7.86176095410978535.5,7.19225;8536.5,7.2469。8585.5,7.227258528.5,6.7745;8529.5,6.83725;8530.5,6.89775。8592.5,6.81458522.5,6.387。8598.5,6.42975;8599.5,6.3625 // f (8560.8193548387) = 7.68016936400298513.5,5.7825。8608.5,5.758;8609.5,5.6915 // f (8560.8131256952) = 7.32713607611658511.5,5.64925。8609.5,5.6915;8610.5,5.625 // f (8560.8188436178) = 7.2936924676944</code></pre><p>用 6—9 組數據測定某至，用 5 個至算得回歸年長度。</p><p>上面數據錄了兩個小時，還有錯，不想再看了，以後再說。用 1277、1279 年冬至，算得 365.242055。當年理論值 365.242234。1277 年冬至時刻是 0.332323 = 7:58:32，實際値 8:40。</p><h3>備忘</h3><p>文科生可以看下這個，@HFLSMathClub： <a href="https://zhuanlan.zhihu.com/p/254963486">数学基本符号介绍</a></p><h2>天文</h2><h3>歲差可靠性驗證</h3><p><v>數</v>頁 188：虞𠠎<v>大同</v>公元前 2300 堯時四正昬中：冬至奎 10，春分井 31，夏至房 1，秋分女 2。頁 190：<v>大衍</v>到<v>明天</v>以前都是公元前 2300 冬至日赤在虛 1，經檢驗，我的赤度昬中算對了。</p><p>明志一：</p><blockquote><p>堯時冬至日躔宿次，何承天推在須女十度左右，一行推在女虛間，元人曆議亦云在女虛之交。而授時曆考之，乃在牛宿二度，大統曆考之，乃在危宿一度，相差二十六度，皆不與堯合。</p></blockquote><p><v>大統</v>在前 2421 年冬至赤道在危 1.092，而<v>授時</v>在牛 3.974，似乎差了將近兩度。</p><blockquote><p>以大統、授時二曆相較，考古則氣差三日，推今則時差九刻。</p><p>今丙申年<n>1596 年</n>日至，臣測得乙未日未正一刻，而大統推在申正二刻，相差九刻</p></blockquote><p>程序大統 1596 年中冬至在乙未 6900=申正二刻，授時在 5952=未正一刻，相差九刻。</p><p><v>皇極</v>日所在宿度直接是黃道度。「劉焯歷仁壽四年<n>605</n>冬至，日在黃道斗十度，於赤道斗十一度也。」我算出來是斗 13，奇怪。</p><p>授時曆議：</p><blockquote><p>以金趙知微所修大明曆法推之，冬至猶躔斗初度三十六分六十四秒</p></blockquote><p>程序算得<v>重修大明</v> 1281 年前冬至己未在斗 0.366<n>小數點後取三位</n>，分毫不差。</p><p>但是，</p><blockquote><p>復以堯典中星考之，其時冬至日在女、虛之交。及考之前史，漢元和二年<n>85 年</n>，冬至日在斗二十一度；晉太元九年<n>384</n>，退在斗十七度；宋元嘉十年<n>433</n>，在斗十四度末；梁大同十年<n>544</n>，在斗十二度；隋開皇十八年<n>598</n>，猶在斗十二度；唐開元十二年<n>724</n>，在斗九度半；今退在箕十度。</p></blockquote><table><thead><tr><th>年</th><th>原文</th><th>大衍</th><th>宣明</th><th>紀元</th><th>統天</th><th>重修大明</th><th>授時</th><th>授時無消長</th></tr></thead><tbody><tr><td>85</td><td>斗 21</td><td>斗 18.197</td><td>斗 18.319</td><td>斗 19.087</td><td>斗 19.294</td><td>斗 18.644</td><td>斗 17.147</td><td>斗 19.775</td></tr><tr><td>384</td><td>斗 17</td><td>斗 14.583</td><td>斗 14.795</td><td>斗 15.018</td><td>斗 15.416</td><td>斗 14.697</td><td>斗 13.857</td><td>斗 15.290</td></tr><tr><td>433</td><td>斗 14 末</td><td>斗 13.990</td><td>斗 14.218</td><td>斗 14.351</td><td>斗 14.763</td><td>斗 14.050</td><td>斗 13.201</td><td>斗 14.555</td></tr><tr><td>544</td><td>斗 12</td><td>斗 12.648</td><td>斗 12.909</td><td>斗 12.841</td><td>斗 13.264</td><td>斗 12.584</td><td>斗 11.860</td><td>斗 12.890</td></tr><tr><td>598</td><td>斗 12</td><td>斗 11.996</td><td>斗 12.273</td><td>斗 12.106</td><td>斗 12.525</td><td>斗 11.871</td><td>斗 11.262</td><td>斗 12.080</td></tr><tr><td>724</td><td>斗 9 半</td><td>斗 10.472</td><td>斗 10.788</td><td>斗 10.391</td><td>斗 10.777</td><td>斗 10.208</td><td>斗 9.635</td><td>斗 10.190</td></tr><tr><td>1280</td><td>箕十</td><td>斗 1.251</td><td>斗 1.735</td><td>斗 0.324</td><td>斗 0.179</td><td>斗 0.366</td><td>箕 9.850</td><td>箕 9.850</td></tr></tbody></table><p>基本上對不上，奇怪。</p><h3>歲實消長可靠性驗證</h3><p>元史：<v>統天</v>「紹熙二年<n>1191</n>辛亥十一月壬申四十七刻」，藤算得 5668.8857 日分 = 0.4724，程序算得壬申 4724，相合。天正定朔藤算得 0157，程序算得 0158，相合。</p><p>藤豔輝<v>宋代朔閏</v>頁 189 有各年<v>紀元</v>、<v>統天</v>冬至時刻，算得與藤完全相同。</p><p>據刘娅娅<v>朱载堉对授时历岁余计算的检验与修正</v>：朱載堉算得隱公三年辛酉<n>前 720</n>年前冬至爲庚午 0600，次年冬至乙亥 5044，程序計算與朱載堉相合。</p><h3>冬至可靠性驗證</h3><p>這是<v>授時曆議</v>的所有數據，程序與原文不一致的列在後面。明顯是傳抄錯誤的標紅，其餘是計算不同。</p><table><thead><tr><th>年</th><th>大衍</th><th>原文</th><th>宣明</th><th>原文</th><th>紀元</th><th>原文</th><th>統天</th><th>原文</th><th>大明</th><th>原文</th><th>授時</th><th>原文</th></tr></thead><tbody><tr><td>獻公 15 年甲寅</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>僖公 5 年-655 辛亥</td><td>辛亥 9493</td><td></td><td>辛亥 6679</td><td></td><td>壬子 8486</td><td><strong>七十四</strong></td><td>辛亥 1992</td><td>二十七</td><td>壬子 8964</td><td></td><td>辛亥 1460</td><td></td></tr><tr><td>昭公 20 年-522 己丑</td><td>己丑 4556</td><td></td><td>己丑 2054</td><td></td><td>庚寅 2502</td><td></td><td>戊子 9535</td><td>九十二</td><td>庚寅 2945</td><td></td><td>戊子 8314</td><td></td></tr><tr><td>元嘉 12 年 435 戊辰</td><td>3539</td><td></td><td>3286</td><td></td><td>3959</td><td></td><td>5327</td><td>五十一</td><td>4145</td><td></td><td>4715</td><td></td></tr><tr><td>13 年 436 甲戌</td><td>癸酉 5984</td><td></td><td>5732</td><td></td><td>6395</td><td></td><td>7768</td><td>七十五</td><td>6581</td><td></td><td>7148</td><td></td></tr><tr><td>15 年 438 甲申</td><td>0872</td><td></td><td>0625</td><td></td><td>1268</td><td></td><td>2650</td><td>二十四</td><td>1453</td><td></td><td>2014</td><td>十九</td></tr><tr><td>16 年 439 己丑</td><td>3316</td><td></td><td>3071</td><td></td><td>3704</td><td></td><td>5091</td><td>四十八</td><td>3889</td><td>三十七</td><td>4447</td><td></td></tr><tr><td>17 年 440 甲午</td><td>5760</td><td></td><td>5518</td><td></td><td>6140</td><td></td><td>7532</td><td>七十二</td><td>6325</td><td></td><td>6880</td><td></td></tr><tr><td>18 年 441 己亥</td><td>8204</td><td></td><td>7964</td><td></td><td>8576</td><td></td><td>9973</td><td>九十七</td><td>8761</td><td></td><td>9313</td><td></td></tr><tr><td>19 年 442 乙巳</td><td>0648</td><td></td><td>0411</td><td></td><td>1012</td><td></td><td>2414</td><td>二十一</td><td>1197</td><td></td><td>1746</td><td></td></tr><tr><td>大明 5 年 461 乙酉</td><td>甲申 7085</td><td></td><td>6893</td><td></td><td>7300</td><td></td><td>8788</td><td>八十九</td><td>7480</td><td></td><td>7973</td><td></td></tr><tr><td>天嘉 6 年 565 庚寅</td><td>1270</td><td></td><td>1321</td><td></td><td>0667</td><td>五</td><td>2487</td><td></td><td>0818</td><td></td><td>1720</td><td></td></tr><tr><td>光大 2 年 568 乙巳</td><td>8602</td><td><strong>八十</strong></td><td>8661</td><td></td><td>7975</td><td></td><td>9802</td><td>九十七</td><td>8126</td><td></td><td>9016</td><td></td></tr><tr><td>太建 4 年 572 丁卯</td><td>丙寅 8378</td><td></td><td>8446</td><td><strong>七十八</strong></td><td>7720</td><td></td><td>9555</td><td></td><td>7870</td><td><strong>九十八</strong></td><td>8744</td><td></td></tr><tr><td>6 年 574 丁丑</td><td>3266</td><td></td><td>3339</td><td></td><td>2593</td><td></td><td>4431</td><td>四十三</td><td>2742</td><td></td><td>3608</td><td></td></tr><tr><td>9 年 577 壬辰</td><td>癸巳 0599</td><td>四</td><td>0679</td><td></td><td>壬辰 9901</td><td></td><td>癸巳 1745</td><td>十六</td><td>0050</td><td></td><td>0904</td><td>八</td></tr><tr><td>10 年 578 戊戌</td><td>3043</td><td></td><td>3125</td><td>三十</td><td>2337</td><td></td><td>4183</td><td>四十</td><td>2486</td><td></td><td>3336</td><td></td></tr><tr><td>開皇 4 年 584 己巳</td><td>7707</td><td></td><td>7804</td><td></td><td>6955</td><td></td><td>8811</td><td>八十六</td><td>7101</td><td></td><td>8624</td><td></td></tr><tr><td>5 年 585 乙亥</td><td>0151</td><td></td><td>0250</td><td></td><td>甲戌 9391</td><td>九十二</td><td>乙亥 1249</td><td>十一</td><td>甲戌 9537</td><td><strong>五十五</strong></td><td>乙亥 1055</td><td></td></tr><tr><td>6 年 586 庚辰</td><td>2595</td><td></td><td>2696</td><td></td><td>1827</td><td></td><td>3687</td><td>三十四</td><td>1973</td><td></td><td>3486</td><td></td></tr><tr><td>7 年 587 乙酉</td><td>5039</td><td></td><td>5143</td><td></td><td>4263</td><td></td><td>6125</td><td>五十九</td><td>4409</td><td></td><td>5917</td><td></td></tr><tr><td>11 年 591 丙午</td><td>4816</td><td></td><td>4929</td><td></td><td>4008</td><td><strong>四十三</strong></td><td>5876</td><td>五十七</td><td>4153</td><td></td><td>5641</td><td></td></tr><tr><td>14 年 594 辛酉</td><td>2148</td><td></td><td>2268</td><td></td><td>1317</td><td></td><td>3189</td><td>三十</td><td>1461</td><td></td><td>2934</td><td></td></tr><tr><td>貞觀 18 年 644 乙酉</td><td>甲申 4352</td><td></td><td>4589</td><td></td><td>3128</td><td></td><td>5048</td><td></td><td>3258</td><td></td><td>4484</td><td></td></tr><tr><td>23 年 649 辛亥</td><td>庚戌 6572</td><td></td><td>6821</td><td></td><td>5309</td><td></td><td>7231</td><td></td><td>5438</td><td></td><td>6639</td><td></td></tr><tr><td>龍朔 2 年 662 戊午</td><td>8345</td><td></td><td>8625</td><td></td><td>6979</td><td></td><td>8904</td><td>八十八</td><td>7105</td><td></td><td>8242</td><td></td></tr><tr><td>儀鳳 1 年 676 壬申</td><td>2562</td><td></td><td>2875</td><td></td><td>1086</td><td></td><td>3009</td><td>二十八</td><td>1208</td><td></td><td>2276</td><td></td></tr><tr><td>永淳 1 年 682 癸卯</td><td>7227</td><td></td><td>7554</td><td></td><td>5704</td><td></td><td>7625</td><td></td><td>5824</td><td></td><td>7460</td><td><strong>六十八</strong></td></tr><tr><td>開元 10 年 722 癸酉</td><td>4990</td><td></td><td>5411</td><td></td><td>3152</td><td></td><td>5041</td><td></td><td>3262</td><td></td><td>4660</td><td></td></tr><tr><td>11 年 723 戊寅</td><td>7434</td><td></td><td>7857</td><td>七十七</td><td>5589</td><td></td><td>7476</td><td></td><td>5698</td><td></td><td>7090</td><td></td></tr><tr><td>12 年 724 癸未</td><td>9878</td><td></td><td>0304</td><td></td><td>8025</td><td></td><td>9911</td><td></td><td>8134</td><td></td><td>9520</td><td></td></tr><tr><td>景德 4 年 1007 戊辰</td><td>1553</td><td></td><td>2643</td><td></td><td>7473</td><td></td><td>8154</td><td>八十二</td><td>7507</td><td>七十四</td><td>8029</td><td></td></tr><tr><td>皇祐 2 年 1050 癸丑</td><td>6648</td><td>六十五</td><td>7839</td><td>七十九</td><td>2230</td><td></td><td>2580</td><td></td><td>2252</td><td></td><td>2390</td><td></td></tr><tr><td>元豐 6 年 1083 丙午</td><td>7303</td><td></td><td>8571</td><td></td><td>2626</td><td></td><td>2694</td><td>二十七</td><td>2639</td><td></td><td>2678</td><td></td></tr><tr><td>7 年 1084 辛亥</td><td>9747</td><td></td><td>壬子 1018</td><td></td><td>辛亥 5062</td><td></td><td>5121</td><td></td><td>5075</td><td></td><td>5104</td><td></td></tr><tr><td>元祐 3 年 1088 壬申</td><td>9523</td><td>九十四</td><td>0804</td><td></td><td>4807</td><td></td><td>4830</td><td></td><td>4818</td><td></td><td>4808</td><td></td></tr><tr><td>4 年 1089 丁丑</td><td>戊寅 1967</td><td></td><td>3250</td><td></td><td>丁丑 7243</td><td></td><td>7257</td><td></td><td>7254</td><td></td><td>7234</td><td></td></tr><tr><td>5 年 1090 壬午</td><td>癸未 4411</td><td></td><td>5696</td><td></td><td>壬午 9679</td><td></td><td>9685</td><td>九十七</td><td>9690</td><td></td><td>9660</td><td></td></tr><tr><td>7 年 1092 癸巳</td><td>9299</td><td></td><td>0589</td><td></td><td>4551</td><td></td><td>4539</td><td></td><td>4562</td><td></td><td>4512</td><td></td></tr><tr><td>元符 1 年 1098 甲子</td><td>乙丑 3964</td><td></td><td>5268</td><td></td><td>甲子 9169</td><td></td><td>9102</td><td></td><td>9178</td><td></td><td>9068</td><td>九十一</td></tr><tr><td>崇寧 3 年 1104 丙申</td><td>8628</td><td></td><td>9946</td><td></td><td>3786</td><td></td><td>3663</td><td></td><td>3794</td><td></td><td>3624</td><td>三十七</td></tr><tr><td>紹熙 2 年 1191 壬申</td><td>癸酉 1263</td><td></td><td>2786</td><td></td><td>壬申 5737</td><td></td><td>4724</td><td></td><td>5721</td><td></td><td>4775</td><td>四十六</td></tr><tr><td>慶元 3 年 1197 癸卯</td><td>甲辰 5928</td><td></td><td>7464</td><td></td><td>0354</td><td></td><td>癸卯 9274</td><td></td><td>甲辰 0337</td><td></td><td>癸卯 9325</td><td>九十二</td></tr><tr><td>嘉泰 3 年 1203 甲戌</td><td>丙子 0592</td><td></td><td>2143</td><td></td><td>乙亥 4971</td><td></td><td>3825</td><td>三十七</td><td>4952</td><td></td><td>3875</td><td>三十七</td></tr><tr><td>嘉定 5 年 1212 壬戌</td><td>癸亥 2589</td><td></td><td>4161</td><td></td><td>壬戌 6897</td><td>六十九</td><td>5653</td><td></td><td>6876</td><td></td><td>5700</td><td>五十六</td></tr><tr><td>紹定 3 年 1230 丙申</td><td>丁酉 6582</td><td></td><td>8196</td><td>八十三</td><td>0749</td><td></td><td>丙申 9313</td><td></td><td>丁酉 0723</td><td></td><td>丙申 9350</td><td>九十二</td></tr><tr><td>淳祐 10 年 1250 辛巳</td><td>壬午 5464</td><td><strong>九十四</strong></td><td>7125</td><td></td><td>辛巳 9473</td><td>九十六</td><td>7832</td><td>七十七</td><td>9442</td><td></td><td>7850</td><td></td></tr><tr><td>至元 17 年 1280 己未</td><td>8786</td><td></td><td>庚申 0518</td><td></td><td>己未 2560</td><td></td><td>0627</td><td>四</td><td>2520</td><td>二十四</td><td>0600</td><td></td></tr></tbody></table><p>這些實例可以證明，五—九、七—九很容易相混。至於其他的差異，不知道爲什麼古人手算那麼不準。</p><h3>躔離可靠性驗證</h3><p><v>授時曆經</v>只有晷漏立成，沒有躔離改正立成。太陽盈縮積度與<v>曆志</v>立成密合。太陰遲疾積度和立成總是差了一點點，比如 61 限，程序 4.9940，立成 4.99381075，87 限，程序 5.4283，立成 5.42827575，這點區別沒有影響。</p><h4>積日 ⇒ 日月盈縮修正</h4><p>的「誤差」一欄：根據該曆盈縮遲疾差的極值算得偏心率，用此偏心率代入開普勒方程算真近點角與平近點角之差，得盈縮遲疾差。誤差=(該曆差-開普勒差)/開普勒差*%</p><h4>幾何模型均數</h4><p>如果偏心率是0，就是默認數值，即橢圓模型0.0169，偏心圓及諸輪模型0.0179208。若輸入某偏心率，則都用該偏心率。</p><h3>步軌漏</h3><h4>會圓術</h4><p>輸入圓的半徑 r、弓形的高「矢」h、週天度。</p><h4>弧矢割圓術</h4><p>此處與上面授時黃赤轉換的區別是這裏可以隨意輸入黃赤交角。第一行「球面三角」是球面三角黃赤轉換的公式，第二行「三角割圓」是用三角函數代替會圓術的弧矢割圓術。弧矢割圓術在黃赤度數和黃赤交角在 45—50 度附近誤差達到最大，約 0.4 度。</p><h4>授時大統可靠性驗證</h4><p><v>元史授時曆經</v>、朝鮮奎章閣<v>授時曆立成</v>、<v>大統通軌</v>、<v>明史曆志</v>都有晨昏立成，<v>曆經</v>、奎章閣是大都晷刻，<v>曆志</v>照錄<v>大統通軌</v>，用應天府晷刻。<v>曆經</v>自變量是黃道積度，其餘三部都是積日，要注意區分。</p><p>弧矢割圓算出來的<v>授時</v>日出與立成密合，區別在 0.0002 刻之內。我又根據立成試出來<v>大統</v>的半弧背，與立成密合，分毫不差，非常完美。</p><h3>月亮位置</h3><p>需要輸入此刻入降交點<n>正交</n>交點月的日數、距離冬至的日數。距離冬至日數會加上日躔、轉換爲黃道度，再進行接下來的計算。正交至半交：白大於黃，半交至正交：黃大於白。一交點月約 27.21222 日。一些觀點認爲，<v>大衍</v>月黃緯表用到了三次內插，我算得前半段<code>Δ = 171, -24, -8</code>後半段<code>Δ = -75, -40, 8</code>；曲安京否定這種說法，實質上還是二次。<v>宋曆</v>第一行赤道度以九道術求得，第二行以黃赤轉換公式求得；<v>授時</v>赤道度則直接以弧矢割圓術求得。赤白差一欄，除了紀元，都是赤道-白道，紀元較爲特殊，日月同名：<code>赤白差 = 黃赤差 + 黃白差</code>，異名：<code>赤白差 = 黃赤差 - 黃白差</code></p><h3>交食</h3><h4>交點月</h4><p>可輸入小數或分數，算出來的小數可通過「同餘」標籤中的「連分數」化爲漸進分數。</p><h4>可靠性驗證</h4><p><v>大業</v>、<v>戊寅</v>、<v>皇極</v>、<v>麟德</v>要根據月份來判斷，這裏爲了簡化輸入，改爲用節氣判斷季節，這不準確。入交日在正交、半交附近發生交食，交點月的一半約爲 13.6061。</p><p>所有唐宋授時曆法的交食我都按原文梳理了一遍，但問題肯定還有，只能留待以後慢慢考慮。用有實例的交食推步論文來檢驗程序：</p><h5>三統</h5><p>漢哀帝元壽元年（前 2）正月辛丑朔日食。</p><blockquote><p>明年正月朔日蝕，上乃徵孔光，免孫寵、息夫躬，罷侍中諸曹黃門郎數十人。宣復上書言：⋯⋯今日蝕於三始，〔如淳曰：「正月一日為歲之朝，月之朝，日之朝。始猶朝也。」〕誠可畏懼。小民正月朔日尚恐毀敗器物，何況於日虧乎！陛下深內自責，避正殿，舉直言，求過失，罷退外親及旁仄素餐之人，</p></blockquote><h5>麟德</h5><p>沒有直接例子。有一條「月在日道裏者，以所如限數減遲速定數，餘以速減遲加其定交分。而出日道表者，爲變交分。不出表者，依定交分。」不懂是做什麼的。</p><h5>大衍</h5><p><v>中國古代曆法</v>頁 539 有三次推算：</p><table><thead><tr><th>日期</th><th><v>中</v>食分</th><th>程序食分</th><th><v>中</v>食甚</th><th>程序食甚</th></tr></thead><tbody><tr><td>724 七月日食</td><td>9.49385</td><td>9.47</td><td></td><td>3218</td></tr><tr><td>724 七月月食</td><td>9.66</td><td>9.66</td><td>8235</td><td>8239</td></tr><tr><td>729 十月日食</td><td>15</td><td>15</td><td>3389</td><td>3440</td></tr></tbody></table><p>729 年主要區別是在定朔上，<v>中</v>是 3402，程序算得 3457，程序的月亮改正大了一些。大衍曆應該沒什麼問題了。</p><h5>宣明</h5><p><v>中</v>頁 605 說日本保存大量<v>宣明</v>預報資料，估計是說<v>韓國科學技術史資料大系天文學編</v>第 2 冊，驪江出版社，1986。還有日本寬永二十一年<n>1665</n>宣明曆刻本。</p><h5>崇天</h5><p>嘉祐六年，</p><blockquote><p>司天言：六月朔，日當食六分半。（《續資治通鑒長編》卷一百九十三）</p></blockquote><p>1061 年行《崇天》，結果見下表，差得有點遠，可能是「九分半強」之訛。</p><p>藤豔輝<v>崇天曆的日食推步術</v>算了天聖二年五月丁亥日食，頁 544 說入轉 22 日轉定分 1377，錯了，應該是 1317。原文是 1377，但是很明顯是原文有誤，這樣食延就有錯了。<v>宋志</v>：「天聖二年五月丁亥，算食二分半，候之不食。」1.66、1.69 按照第一種標準是一分半強，按第二種標準是一分半，原文當爲一分半。</p><table><thead><tr><th>日期</th><th>藤食分</th><th>程序食分</th><th>藤食甚</th><th>程序食甚</th><th>備註</th></tr></thead><tbody><tr><td>1024 五月丁亥</td><td>1.66</td><td>1.69</td><td></td><td>4402</td><td></td></tr><tr><td>1026 十月癸酉</td><td>6.4</td><td>6.44</td><td>9:38</td><td>4019=9:38:44</td><td></td></tr><tr><td>1029 八月丁亥</td><td>9.3</td><td>9.33</td><td>7:06</td><td>2958=7:05:57</td><td></td></tr><tr><td>1040 閏正月丙辰</td><td>5.2</td><td><strong>4.79</strong></td><td>13:43</td><td>5721=13:43:49</td><td></td></tr><tr><td>1042 六月壬申</td><td>5.1</td><td>5.02</td><td>18:27</td><td>7693=18:27:47</td><td></td></tr><tr><td>1046 三月辛巳</td><td>7.2</td><td>7.27</td><td>13:15</td><td>5527=13:15:53</td><td></td></tr><tr><td>1053 十月丙申</td><td>4.4</td><td><strong>5.84</strong></td><td>12:56</td><td>6386=15:19:35</td><td>估計是 5.4 輸錯了</td></tr><tr><td>1054 四月甲午</td><td>9.8</td><td><strong>9.55</strong></td><td>16:04</td><td>6695=16:04:04</td><td></td></tr><tr><td>1059 閏正月丙申</td><td>5.2</td><td>5.38</td><td>12:50</td><td>5341=12:49:06</td><td></td></tr><tr><td>1061 六月壬子</td><td>9.8</td><td>9.83</td><td>13:41</td><td>5706=13:41:39</td><td></td></tr></tbody></table><p>食甚時刻全部符合，食分有三個區別比較大，達到 0.4 分，由於文中沒有推算過程，不知道問題出在哪一步。看了下有推算過程的天聖二年五月丁亥，半晝分相符，那應該不是半晝分的問題。總之，崇天基本上沒什麼問題。</p><p>另外，藤豔輝<v>宋代朔閏</v>也有崇天紀元的計算結果，但是跟後來發的論文出入很大，估計是這篇論文的程序還有問題。</p><p>熙寧六年三月，</p><blockquote><p>司天監言：四月朔，日當食九分。（《續資治通鑒長編》卷二百四十三）</p></blockquote><p>程序算得《崇天》1073 四月甲戌朔日食分 9.05 虧 1608 甚 2540，相合。</p><h5>奉元</h5><p>元祐六年，</p><blockquote><p>太史奏：五月朔，日當食六分。（《續資治通鑒長編》卷四百五十七）</p></blockquote><p>1091 行《奉元》，程序 v1.03 算得《奉元》五月己未分 4.01，《觀天》分 2.71，《紀元》分 3.93</p><h5>紀元</h5><p>藤豔輝<v>紀元曆日食算法及精度分析</v>：</p><table><thead><tr><th>日期</th><th>宋史食分</th><th>藤食分</th><th>程序食分</th><th>宋史初虧</th><th>藤初虧</th><th>程序初虧</th><th>藤食甚</th><th>程序食甚</th><th>宋史復滿</th><th>藤復滿</th><th>程序復滿</th></tr></thead><tbody><tr><td>1107 十二月壬子</td><td></td><td>8.14</td><td><strong>8.53</strong></td><td></td><td></td><td></td><td>14.0922</td><td>5872=14.0928</td><td></td><td></td><td></td></tr><tr><td>1108 五月庚戌</td><td></td><td>3.40</td><td>3.41</td><td></td><td></td><td></td><td>12.5541</td><td>5208=12.4992</td><td></td><td></td><td></td></tr><tr><td>1110 九月丙寅</td><td></td><td>1.62</td><td>1.65</td><td></td><td></td><td></td><td>16.8216</td><td>7021=16.8504</td><td></td><td></td><td></td></tr><tr><td>1112 九月乙卯</td><td></td><td>1.48</td><td><strong>5.97</strong></td><td></td><td></td><td></td><td>4.7390</td><td>1982=4.7568</td><td></td><td></td><td></td></tr><tr><td>1113 三月壬子</td><td></td><td>3.25</td><td>3.26</td><td></td><td></td><td></td><td>13.9006</td><td>5789=13.8936</td><td></td><td></td><td></td></tr><tr><td>1115 七月戊辰</td><td></td><td>5.44</td><td>5.44</td><td></td><td></td><td></td><td>11.6928</td><td>4867=11.6808</td><td></td><td></td><td></td></tr><tr><td>1118 五月壬午</td><td></td><td>2.32</td><td>2.30</td><td></td><td></td><td></td><td>18.4204</td><td>7671=18.4104</td><td></td><td></td><td></td></tr><tr><td>1119 四月丙子</td><td></td><td>6.34</td><td><strong>7.13</strong></td><td></td><td></td><td></td><td>18.8275</td><td>7838=18.8112</td><td></td><td></td><td></td></tr><tr><td>1120 十月戊辰</td><td></td><td>8.83</td><td>8.84</td><td></td><td></td><td></td><td>13.5898</td><td>5670=13.6080</td><td></td><td></td><td></td></tr><tr><td>1122 二月庚寅</td><td></td><td>7.51</td><td>7.49</td><td></td><td></td><td></td><td>13.6496</td><td>5698=13.6752</td><td></td><td></td><td></td></tr><tr><td>1123 八月辛巳</td><td></td><td>9.06</td><td>9.02</td><td></td><td></td><td></td><td>5.7544</td><td>2390=5.7360</td><td></td><td></td><td></td></tr><tr><td>1134 七月戊申</td><td></td><td>1.89</td><td>1.91</td><td></td><td></td><td></td><td>13.0021</td><td>5413=12.9912</td><td></td><td></td><td></td></tr><tr><td>1135 正月乙巳</td><td>九分半</td><td>9.68</td><td>9.68</td><td>辰正</td><td>8:19=辰正一刻</td><td>3471=8:19</td><td>10.3419</td><td>4310=10.344</td><td></td><td></td><td></td></tr><tr><td>1167 四月戊辰</td><td>二分</td><td>3.64</td><td>3.65</td><td></td><td></td><td></td><td></td><td>5796</td><td></td><td></td><td></td></tr><tr><td>1168 二月望</td><td>食既</td><td>15</td><td>15</td><td></td><td></td><td></td><td></td><td>7428</td><td>戌正三刻</td><td>20:40=8615=戌正三刻</td><td>8356=20:03=戌正初刻</td></tr><tr><td>1176 正月望</td><td>二分及三分以上</td><td>6.42</td><td>6.42</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>最後一條 1168 二月望，考慮了一下，感覺是史載和藤都沒加月食時差，加入時差後食甚會減少一些，復圓就提前一些。</p><p>除了三個不太相合的，<v>紀元</v>基本上沒問題。應該是特殊情況的處理沒對，留待以後考慮。</p><h5>其他宋曆</h5><p>以下據藤豔輝<v>宋代</v>頁 185:</p><table><thead><tr><th>序號</th><th>曆法</th><th>日期</th><th>宋史食分</th><th>藤食分</th><th>程序食分</th><th>宋史初虧</th><th>藤初虧</th><th>程序初虧</th><th>宋史食甚</th><th>藤食甚</th><th>程序食甚</th><th>宋史復滿</th><th>藤復滿</th><th>程序復滿</th></tr></thead><tbody><tr><td>1</td><td>乾道</td><td>1167 四月戊辰朔</td><td>一分</td><td>2.67</td><td>3.51</td><td></td><td></td><td></td><td></td><td></td><td>5883</td><td></td><td></td><td></td></tr><tr><td>2</td><td>乾道</td><td>1167 八月庚戌望</td><td>六分半</td><td>5.63</td><td>6.07</td><td></td><td></td><td></td><td></td><td></td><td>8968</td><td></td><td></td><td></td></tr><tr><td>3</td><td>乾道</td><td>1168 二月望</td><td>食既</td><td>15</td><td>15</td><td></td><td></td><td></td><td></td><td></td><td></td><td>二更五點 21:39</td><td>21:39</td><td>8370</td></tr><tr><td>4</td><td>乾道</td><td>1173 五月朔</td><td>四分半 + 二分少強≒七分</td><td>8.62</td><td>7.75</td><td>午時五刻半-四刻半≒午初初刻</td><td>11:12</td><td>4630=午初初刻</td><td>未初二刻 - 三刻</td><td>13:21</td><td>5445=13:04</td><td>申初一刻 + 二刻已上</td><td>15:30</td><td>6259</td></tr><tr><td>5</td><td>淳熙</td><td>1176 九月望</td><td>小分百中之二十七 0.27</td><td>2.72*</td><td></td><td>攢點九刻</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td>統元</td><td></td><td>二分及三分以上</td><td>1.62*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td>乾道</td><td></td><td></td><td>4.01*</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>6</td><td>淳熙</td><td>1185 三月望</td><td>幾五</td><td>4.92</td><td>4.92</td><td></td><td></td><td></td><td>二更二點</td><td>22:19</td><td>9341=22:25=二更四點</td><td></td><td></td><td></td></tr><tr><td>7</td><td>淳熙</td><td>1185 九月望</td><td>大分五小分二十六</td><td>5.25</td><td>5.27</td><td>卯初三刻，系攢點九刻後</td><td>5:30</td><td>2195=5:16=卯初一刻</td><td>卯正三刻後</td><td>6:35</td><td>2671=6:24=卯正一刻</td><td>辰正初刻後</td><td>7:39</td><td>3147=辰初二刻</td></tr><tr><td>8</td><td>統天</td><td>1202 五月甲辰朔</td><td></td><td>空</td><td>3.52</td><td>午初一刻-一辰有半</td><td>10:56</td><td>4453=10:41=巳正二刻</td><td>午正</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>9</td><td>開禧</td><td>1220</td><td>食</td><td>不食</td><td>不食</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>10</td><td>統天</td><td>1245 七月癸巳朔</td><td></td><td>8.40</td><td>3.39</td><td></td><td>13:49</td><td>6022=未正一刻</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td>開禧</td><td></td><td>八分</td><td>9.35</td><td>8.01</td><td>未初三刻</td><td>14:01=未正初刻</td><td>5810=13:56= 未初三刻</td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>10 沒說按照哪部曆法算出來八分，如果按照我的結果，就是<v>開禧</v>，按照藤的結果，是<v>統天</v>。統天差得有點多，估計是歲實消長算法不一樣。我紀元的月食時差似乎有點問題。</p><h5>授時</h5><p><v>中國古代曆法</v>頁 669 有三次日食推算：</p><table><thead><tr><th>日期</th><th>元史食分</th><th><v>中</v>食分</th><th>程序大統通軌食分</th><th><v>中</v>食甚</th><th>程序食甚</th><th>程序授時食分</th><th>授時食甚</th></tr></thead><tbody><tr><td>1292 正月</td><td></td><td>7.168</td><td>9.44</td><td>5481.8</td><td>5482</td><td>7.77</td><td>5914</td></tr><tr><td>1299 八月</td><td>二分有奇</td><td>2.67</td><td>2.67</td><td>4390</td><td>4385</td><td>3.28</td><td>4856</td></tr><tr><td>1302 六月</td><td>五十七秒</td><td>1.15</td><td>0.35</td><td>8058</td><td>8061</td><td>0.48</td><td>8130</td></tr></tbody></table><p>李勇<v>授時曆與仲康日食推算</v>列出了前 2200—前 1799 年<v>授時曆日食典</v>，<v>授時曆預報 2012 年日食</v>列出了 1990—2050 日食典。經過核對，發現連食甚時刻都差了許多，因此食分也差了 1 分左右，最大的可能是歲實消長算法不一樣。</p><p>魏文魁抨擊<v>授時</v><n><v>明志</v>一</n>：</p><blockquote><p>宋文帝元嘉六年十一月己丑朔，日食不盡如鉤，晝星見。今以授時推之，止食六分九十六秒⋯⋯</p></blockquote><p>429 年十一月己丑朔，程序算得：</p><ul><li>大統通軌、大統曆志分 6.96</li><li>授時分 6.91 虧 3256 甚 3744</li></ul><h5>大衍、大明、授時</h5><p>授時曆議：</p><p>開始的兩個仲康日食、十月之交日食先不管。</p><p>春秋日食：</p><table><thead><tr><th></th><th>大衍</th><th>原文</th><th>授時</th><th>原文</th></tr></thead><tbody><tr><td>隱公三年-719 二月己巳</td><td>13.10</td><td></td><td>不食</td><td>去交分二十六日六千六百三十一入食限</td></tr><tr><td>桓公三年-708 七月壬辰</td><td>12.91</td><td></td><td>7.12</td><td>食六分一十四秒</td></tr><tr><td>十七年-694 十月</td><td>10.47</td><td></td><td>7.18</td><td>交分二十六日八千五百六十入食限</td></tr><tr><td>莊公十八年-675 三月</td><td>不食</td><td></td><td>8.76</td><td></td></tr><tr><td>二十五年-668 六月辛未</td><td>11.57</td><td></td><td>7.54</td><td>交分二十七日四百八十九入食限</td></tr><tr><td>二十六年-667 十二月癸亥</td><td>13.40</td><td></td><td>6.33</td><td>交分十四日三千五百五十一入食限</td></tr><tr><td>三十年-663 九月庚午</td><td>11.34</td><td></td><td>7.38</td><td>去交分十四日四千六百九十六入食限</td></tr><tr><td>僖公十二年-647 三月庚午</td><td>10.02</td><td></td><td>4.03</td><td>去交分二十六日五千一百九十二入食限</td></tr><tr><td>十五年-644 五月</td><td>不食</td><td></td><td>不食</td><td>去交分一日一千三百一十六入食限</td></tr><tr><td>文公元年-625 二月癸亥</td><td>10.89</td><td></td><td>7.11</td><td>去交分二十六日五千九百十七分入食限</td></tr><tr><td>十五年-611 六月辛丑</td><td>7.75</td><td></td><td>8.70</td><td>交分二十六日四千四百七十三分入食限</td></tr><tr><td>宣公八年-600 七月甲子</td><td></td><td></td><td></td><td></td></tr><tr><td>十年-598 四月丙辰</td><td></td><td></td><td></td><td></td></tr><tr><td>十七年-591 六月癸卯</td><td></td><td></td><td></td><td></td></tr><tr><td>成公十七年-573 十二月丁巳</td><td></td><td></td><td></td><td></td></tr><tr><td>襄公十四年-558 二月乙未</td><td></td><td></td><td></td><td></td></tr><tr><td>十五年-557 八月丁巳朔</td><td></td><td></td><td></td><td></td></tr><tr><td>二十年-552 十月丙辰</td><td></td><td></td><td></td><td></td></tr><tr><td>二十一年-551 七月庚戌</td><td></td><td></td><td></td><td></td></tr><tr><td>十月庚辰</td><td></td><td></td><td></td><td></td></tr><tr><td>二十三年-549 二月癸酉</td><td></td><td></td><td></td><td></td></tr><tr><td>二十四年-548 七月甲子</td><td></td><td></td><td></td><td></td></tr><tr><td>八月癸巳</td><td></td><td></td><td></td><td></td></tr><tr><td>二十七年-545 十二月乙亥</td><td></td><td></td><td></td><td></td></tr><tr><td>昭公七年-534 四月甲辰</td><td></td><td></td><td></td><td></td></tr><tr><td>十五年-526 六月丁巳</td><td></td><td></td><td></td><td></td></tr><tr><td>十七年-524 六月甲戌</td><td></td><td></td><td></td><td></td></tr><tr><td>二十一年-520 七月壬午</td><td></td><td></td><td></td><td></td></tr><tr><td>二十二年-519 十二月癸酉</td><td></td><td></td><td></td><td></td></tr><tr><td>二十四年-517 五月乙未</td><td></td><td></td><td></td><td></td></tr><tr><td>三十一年-510 十二月辛亥</td><td></td><td></td><td></td><td></td></tr><tr><td>定公五年-504 三月辛亥</td><td></td><td></td><td></td><td></td></tr><tr><td>十二年-497 十一月丙寅</td><td></td><td></td><td></td><td></td></tr><tr><td>十五年-494 八月庚辰</td><td></td><td></td><td></td><td></td></tr><tr><td>哀公十四年-480 五月庚申</td><td></td><td></td><td></td><td></td></tr></tbody></table><p>三國以來日食：</p><table><thead><tr><th></th><th>大衍</th><th>原文</th><th>大明</th><th>原文</th><th>授時</th><th>原文</th></tr></thead><tbody><tr><td>章武元年 221 六月戊辰</td><td></td><td></td><td>6426=申一刻</td><td>食甚未五刻</td><td>5959=未五刻</td><td>食甚未五刻</td></tr><tr><td>黃初三年 222 十一月庚申</td><td></td><td></td><td>6630=申三刻</td><td>食甚申三刻</td><td>6480=申二刻</td><td>食甚申二刻</td></tr><tr><td>中大通五年 533 四月己未</td><td></td><td></td><td>不食</td><td>虧初午四刻</td><td>5024=午四刻</td><td>虧初午四刻</td></tr><tr><td>太清元年 547 正月己亥</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>太建八年 576 六月戊申</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>永隆元年 680 十一月壬申</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>開耀元年 681 十月丙寅</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>嗣聖八年 691 四月壬寅</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>十七年 700 五月己酉</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>十九年 702 九月乙丑</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>景龍元年 707 六月丁卯</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>開元九年 721 辛酉九月乙巳</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>慶曆六年 1046 三月辛巳</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>皇祐元年 1049 正月甲午</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>五年 1053 十月丙申</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>至和元年 1054 四月甲午</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>嘉祐四年 1059 正月丙申</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>六年 1061 六月壬子</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>治平三年 1066 九月壬子</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>熙寧二年 1069 七月乙丑</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>元豐三年 1080 十一月己丑</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>紹聖元年 1094 三月壬申</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>大觀元年 1107 十一月壬子</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>紹興三十二年 1162 正月戊辰</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>淳熙十年 1183 十一月壬戌</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>慶元元年 1195 三月丙戌</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>嘉泰二年 1202 五月甲辰</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>嘉定九年 1216 二月甲申</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>淳祐三年 1243 三月丁丑</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>中統元年 1260 三月戊辰朔食</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>至元十四年 1277 十月丙辰</td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h5>大統</h5><p>明志一：</p><blockquote><p>景泰元年正月辛卯，卯正三刻月食。監官誤推辰初初刻，致失救護。</p></blockquote><p>1450 年正月月食分 11.55 虧 2950=辰初初刻。</p><blockquote><p>正德九年八月辛卯日食，曆官報食八分六十七秒⋯⋯</p></blockquote><p>1514 年八月辛卯朔，分 9.01 甚 5096，差了 0.34 分。有可能是回回曆推的？</p><blockquote><p><n>嘉靖</n>七年，欽天監奏：閏十月朔，回回曆推日食二分四十七秒，大統曆推不食。</p></blockquote><p>1528 年閏十月己巳朔，分 2.03 虧 4170 甚 4525。問題可能在於我沒有判斷是否入食限，所有的都情況直接進入程序算食分。</p><blockquote><p>萬曆十二年十一月癸酉朔，大統曆推日食九十二秒，回回曆推不食。⋯⋯邇年月食在酉而曰戌，月食將旣而曰未九分</p></blockquote><p>1584 年十一月癸酉朔，分 0.93 甚 5030，程序密合。</p><blockquote><p><n>丙申</n>閏八月朔，日食，大統推初虧巳正二刻，食幾既，而臣候初虧巳正一刻，食止七分餘。大統實後天幾二刻⋯⋯</p></blockquote><p>1596 年閏八月乙丑朔，分 9.88 虧 4529=巳正三刻。食分密合，初虧晚了一刻。</p><blockquote><p><n>萬曆</n>二十五年五月甲戌夜月食，監官推算差一日。</p></blockquote><blockquote><p><n>崇禎</n>五年九月十五日月食，監推初虧在卯初一刻，光啓等推在卯初三刻，回回科推在辰初初刻。</p></blockquote><p>1632 年九月己酉望月食，程序大統分 5.01 虧 2222=卯初一刻</p><blockquote><p><n>崇禎</n>十年正月辛丑朔日食⋯⋯大統推食一分六十三秒⋯⋯</p></blockquote><p>1637 年正月辛丑朔，程序大統分 3.70。可能是「三分」之訛。</p><p>以下是 1442 年朝鮮<v>交食通軌</v>所附<v>授時曆各年交食</v>，是<v>大統通軌</v>算法的交食細草，共八次月食、一次日食，是僅存的古曆細草，我節選部分參數。以下程序與細草密合。</p><table><thead><tr><th></th><th>1430 閏十二月望</th><th>1431 十二月望</th><th>1435 四月望</th><th>1435 十一月日食</th></tr></thead><tbody><tr><td>盈縮曆</td><td>46.4964975</td><td></td><td></td><td>342.596781</td></tr><tr><td>原文</td><td></td><td></td><td></td><td></td></tr><tr><td>盈縮差</td><td></td><td></td><td></td><td></td></tr><tr><td>原文</td><td>一度八二三六九〇</td><td></td><td></td><td></td></tr><tr><td>遲疾曆</td><td>12.2379975</td><td></td><td></td><td>5.813881</td></tr><tr><td>原文</td><td></td><td></td><td></td><td></td></tr><tr><td>遲疾差</td><td></td><td></td><td></td><td></td></tr><tr><td>原文</td><td>一度九六四七二八</td><td></td><td></td><td></td></tr><tr><td>交泛</td><td></td><td></td><td></td><td>14.554661</td></tr><tr><td>原文</td><td></td><td></td><td></td><td></td></tr><tr><td>交前後度</td><td></td><td></td><td></td><td></td></tr><tr><td>原文</td><td>一十〇度六五三一六四二九六八</td><td></td><td></td><td></td></tr><tr><td>食分</td><td>2.76</td><td>11.73</td><td>8.61</td><td>7.52</td></tr><tr><td>原文</td><td>二分七十五秒</td><td>一十一分七十三秒一四四</td><td>八分六十一秒〇五</td><td>七分五十二秒</td></tr><tr><td>食甚</td><td>9291</td><td>0263</td><td></td><td>5554</td></tr><tr><td>原文</td><td>九千二百九一一九七〇五</td><td>二百六十三分四〇四四</td><td></td><td>五千五百五四四六六五</td></tr><tr><td>初虧</td><td>8826</td><td>9535</td><td></td><td></td></tr><tr><td>原文</td><td>八千八百二六三一一四〇七</td><td>九千五百三五三四八三五</td><td></td><td></td></tr></tbody></table><p>授時交食應該沒什麼問題了。</p><h5>誤差原因分析</h5><ul><li>躔離改正：大統通軌用立成表算，我直接用三次函數。</li><li>晨昏分：大統通軌用整數日入表，沒考慮冬至小分。</li></ul><h3>儒略日 ⇌ 日期</h3><p><code>日干支序 = (儒略日 -11) mod 60 + 1</code></p><h3>公元年 ⇌ 年干支</h3><p><code>年干支序 = ((公元年 - 3) mod 60 + 60) mod 60</code></p><h2>琴律計算器</h2><p>臨時借用一下曆法的網站，開一個琴律計算器。詳見 <a href="https://kqh.me/key/02">赫赫金鑰｜琴律學</a></p><h3>減字譜轉唱名</h3><p>我做好之後翻《陳長林琴學文集》，陳先生在 1989 年就做好了。（《計算機學報》1989(7)）</p><ul><li>【格式】<code>類型，徽位，弦;</code>。s 散音 <code>s,6;</code>。f 泛音；長段泛音用 <code>[]</code> 包裹，如 <code>[7,6;9,3];</code> = <code>f,7,6;f,9,3;</code>。l 連音（上滑下滑）<code>7,7;l,7</code>，zh 撞，<code>7,7;zh;</code>。qi 起，<code>7,7;qi;</code> 空弦帶起；<code>7,7;qi,7.6;</code> 七徽六搯起。shang 上，xia 下 <code>9,1;shang</code>，<del>fenkai 分開。suo3 璅三聲，suo7 璅七聲，suo9 璅九聲 <code>s,7;suo7;</code>dayuan 打圓。</del></li><li>【品弦法】見上「品弦法」部分</li><li>【律制】1 徽法律一，2 徽法律二，3 徽法律三，4 徽法律四，5 準法律。近代琴曲一般都是準法律</li><li>【宮弦】以幾弦爲宮音。大多數曲子都是以三弦爲宮的正調【徵弦】一些調沒有宮音散音，就填徵弦。如果填了徵弦，會覆蓋宮弦的輸入參數</li><li>【基準頻率】卽正調五弦頻率</li><li>【輸出模式】1 音名；2 唱名；3 與宮弦的頻率比</li><li>【嚴格模式】默認否，程序會自動將音準歸到標準音高，例如按音徽分大多是約值，程序將自動調整。如果輸入 1 開啟嚴格模式，輸出模式 1、2 顯示 undefined，可以將輸出模式切換到 3，查看頻率比。</li><li>【顯示結果】৹ 泛音；◠ 連音；^ 撞；· 在左表示高一個八度，· 在右表示低一個八度；<span class="upline1">上劃線</span>、<span class="upline2">上劃線</span> 高一、兩個普通音差，<span class="dnline1">下劃線</span>、<span class="dnline2">下劃線</span> 低一、兩個普通音差。普通音差＝ 大全音 ﹣ 小全音 ＝ 81/80 = 21.5 音分。</li></ul><p>示例是査阜西《洞庭》第一、二段。第一句 9.6 徽（b4），準確約值是 9.46（3）。</p><img src="https://pic.imgdb.cn/item/6172d1262ab3f51d911ef6dd.png"><img src="https://pic.imgdb.cn/item/61791a422ab3f51d91e88438.jpg"><p>抓起、散音同聲暫時沒處理。</p><p><v>幽蘭</v>開頭：</p><img src="https://pic.imgdb.cn/item/617566142ab3f51d91453741.jpg"><p><code>s,1;9.9,2;s,1;9.9,2;l,14;s,2;1;2;2;1;2;14,2;3;3;2;3;s,5;4;10,2;s,4;8,2;s,5;11,1;9,1;2;1;2;8,2;l,7.6;s,2;1;10,4</code></p><p>第三段開頭泛音：</p><img src="https://pic.imgdb.cn/item/617566142ab3f51d9145374a.jpg"><p><code>[10,5;6;5;6;11,5;6;5;6;13,3;12,5;4;5;4;5;5;11,6;12,4;5;4;3;10,6;10,7;6;5;6;5;4;9,6;10,5;4;5;6;7;6;12,3;10,6;11,4;10,5;5;4;3;4;3;4;3;4;6;5;11,3;10,3,5;11,4;10,6;9,4;3;4;5;4;5;11,4;3;12,5;11,4;3;4;3;2;3;2;1;9,4;3;4;5;4;5]</code></p><p><v>幽蘭</v>以一弦爲宮。<v>洞庭</v>一三四段以四弦爲宮，第一段有 1 2 3 4 5 6，那就是徵調法或者商調法。正調四弦散音爲 G 黃鐘，那就是黃鐘爲徵調或者仲呂之徵調。不過譜子上寫的「林鐘均側弄」。</p><p>這是<v>古怨</v>，品弦法 12，律制 1</p><p><code>9,7;s,5;9,7;s,5;9,7;s,5;9,7;s,4;5;9,7;s,6;7;7,7;s,7;5;9,7;8,7;l,7;7,7;l,8;s,4;9,6;7;9.5,5;10,5;6;s,2;9,4;s,1;2;8.4,4;[9,7;10,5;9,7;10,5;9,7;10,5;9,7;10,4;5;9,7;10,6;7;7;10,5;9,7;10,6;7;7;6;5;5;9,6;10,5;1;2;3;2];s,6;1;2;3;11,1;s,3;1;2;1;3;11,1;s,3;10,1;2;1;11,2;l,10;s,4;11,2;10,3;s,5;10,3;4;3;4;l,8.4;s,7;9,5;8.4,4;s,7;7,5;4;5;6;5.6,2;l,7;7,6;5;6;l,6.2;s,2;6.2,6;s,3;2;6.2,6;8,7;l,7;7;l,8;7.6,6;s,5;9,7;8,7;8.4,4;9,5;l,8;s,4;9,6;5;6;7;8.4,5;10,5;9.4,4;s,2;8.4,4;s,3;11,1;s,3;11,1;s,3;11,1;s,3;11,1;l,7;[7,3;7;6;2;7]</code></p><p>只有這句<br> <code>s,6;1;2;3;11,1;s,3;1;2;1;3;11,1;s,3;10,1;2;1;11,2;l,10;s,4;11,2;10,3;s,5;</code>是以一弦爲宮，其他都是二弦爲宮。</p><p>這是<v>神奇</v>版<v>澤畔吟</v>，淒涼調，律制 3。原譜一弦十二徽半，但是只有 12 徽有音。又如 s,5;10,3 相應，原譜是 10 徽。</p><p><code>11,2;s,4;1;11,2;s,4;11,2;s,7;11,5;s,7;9,6;2;s,5;7.6,7;l,9;6;9,2;9,4;6;l,10;s,7;11,5;10,1;s,3;11,2;l,9;s,5;9.89,3;l,10.8;qi;s,7;4;9,6;5;6;5;7.6,7;7;zh;l,9;6;8.6,5;9,6;8.4,7;9,6;l,11;5;10,4;11,5;10,6;11,5;10,4;3;1;11,2;l,9;l,8;s,6;5;3;11,2;l,9;s,5;[11,2;10,4;10,1;2;5;11,2;10,7;11,5;10,7;12,6;3;10,5;7;11,3;10,4;11,2;13,6;5;10,4;5;11,2;10,6;4;12,6;10,7;12,4;10,7;4;5;7;12,4;10,7;4;5;4;7;12,4;10,7;12,2;10,5;11,2;12,6;11,3;10,7;4;12,6;5;6;5;7;5;6;4;5;10,4;6;5;11,2;12,2;10,5];8.4,7;s,5;8.4,7;l,9;9,6;11,5;5;s,7;11,5;s,7;6;9,3;yin;s,7;5;10,3;zh;l,11;s,4;11,2;12,1;qi;s,2;4;11,2;s,4;12,1;qi;s,2;1;2;4;11,2;s,4;5;9,2;7.6,6;zh;xia;8,5;7.6,4;nao;s,7;9,4;2;1;l,7.55;s,5;7;9,2;nao,l,9.5;9,1;14,1;l,10;s,3;10,3;l,11;2;s,4;9,2;8,3;7.6,4;7;yin;l,7.6;9,6;5;7.6,7;nao,qi;s,5;8.4,7;l,9;9,6;s,4;9,6;s,2;4;9,6;10,5;9,6;10,5;l,11;10,4;3;6;nao;qi;s,1;2;10,5;10,4;s,1;10,4;10,5;s,2;10,5;10,7;s,4;10,7</code></p><p>下爲神奇瀟湘第八段泛音</p><p><code>[10,1;9,3;10,4;9,6;10,5;3;11,1;9,3;6;10,1;2;9,4;10,3;2;1;6;4;5;4;7;4;12,3;1;10,4;5;11,5;12,5;7;6;4;10,7;13,5;6;4;12,7;13,3;4;1;12,4;10,5;6;4;7;4;12,3;1;10,4;6;10,2;3;4;5;4;3;2;2;9,6;5;10,2;10,7;7;7;7;7;7;7;6;5;5;12,1;10,4]</code></p><p>下爲山中思友人第二段泛音</p><p><code>[10,5;7;12,4;10,7;12,5;11,6;12,4;10,7;12,3;10,6;12,4;10,7;12,5;10,5;12,7;6;10,4;12,6;10,5;11,6;12,5;12,7;6;10,4;12,6;5;11,6;12,4;10,7;12,3;10,6;12,4;10,7;12,5;10,5;9,7;6;10,4;9,6;10,5;4;7;9,5;4;7;6;5;10,4;9,6]</code></p><p>下爲神奇<v>離騷</v>第一段泛音 <code>[10,1;9,3;10,4;9,6;10,6;1;6;5;9,7;14,6;9,6;10,4;9,6;10,6;9,4;7,7;9,6;3;7,6;9,2;7,5;6;4;9,1;7,4;2;1;5;6;7;9,4;9,6;2;4;3;1;2;7,2;8,4;9,2;9,1;7,6]</code> 第十段 <code>[7,4;7,7;9,4;7,7;9,6;2;7,6;4;9,1;7,4;9,5;6;5;7;6;7,4;9,6;10,5;9,6;5;4;7,7;5;4;5;7;6;9,3;7,6;3;4;3;8,5;9,5;2;7,6;5;9,1;2;7,5]</code> 十五段 <code>[10,4;7;12,4;10,7;6;12,1;10,5;4;12,1;10,4;6;5;7;6;12,3;10,6;5;4;3;12,1;10,4;2;1;6;2;3;4;4;10,6;5;4;12,2;10,5;7,2;7,5;9,2;7,6;5;9,1;2;7,5;1;4;2;1;4;5;5;2;6;5;9,1;2;7,5]</code></p><p>下爲<v>短淸</v>泛音：</p><p><code>[10,2;9,4;10,4;9,6;5;4;10,2;9,4;1;2;4;3;10,1;9,3;1;10,1;12,3;4;3;10,1;12,3;4;3;4;5;11,1;12,5;10,5;4;5;6;7;6;5;12,3;10,6]</code></p><p>下爲<v>華胥引</v>開頭泛音：</p><p><code>[7,1;5,2;4,5;5,5;4;5;6;4,1;6;4;5;6;5;4;3;2,5;4;5;6;5;4;4,3;5,5;4,4;5;6;5;6;3;5,5;4;5;6;5;6;2;7,5;4;5;6;5;6;7,3;9,5;4;5;6;5;6;9,2]</code> 曲中泛音 <code>[7,4;5;6;5;6;3;9,5;4;5;6;5;6;9,2]</code></p><p><v>秋月照茅亭</v></p><p><code>[10,1;9,5;4;6;10,2;9,4;10,1;2;3;9,7;10,3;4;9,6;12,6;11,6;10,2;3;4;7;11,6;12,4;10,7;5;12,4;10,7;10,3;2;9,7;10,3;4;9,6;7;10,4;9,6]</code></p><p><v>白雪</v>第一段泛音：<code>[9,4;5;10,4;5;5;9,4;5;10,4;5;8,2;9,1;10,1],s,6;[9,4;5;10,4;9,6;7;6;10,5;6;9,1;10,4;9,4;5;10,4;9,6;4;2;10,5;9,2;4;3;2;3;4;5;5;10,1;9,5;4;3;5;6;10,2;9,4;3;1;3;4]</code> 第五段泛音 <code>[12,4;5;5;10,4;5;5;12,4;5;11,3;10,5;12,4;10,1;6;12,7;6;5;10,5;6;5;4;12,5;11,1;12,5;3;4;3;5;11,1;12,5;4;5;6;10,4;7;6;4;10,1;10,6]</code> 第九段 <code>[9,6;10,4;9,6;10,3;5;6;3;4;9,6;10,1;11,1;2;9,7;10,3;11,1;9,5;4;3;4;5;10,2;9,4;1;2;3;4;3;7,1;6;4;1;6]</code></p><p><v>神人暢</v>一二段泛音：<code>[7,1;9,3;7,2;9,4;7,1;5,3;7,2;5,4;4,3;5;2,3;5;4;1,2;2,4;1,3;4;5;2,2;1,5;1,3;4;3;1,5;2,2;1,5;3;2,5;4;1,2;2,4;3;3,4;4,5;2,2;4,5;2,4;4,3;5;2,2;4,5;3,4;4,5;2,2;4,5;5,3;5;4,5;3;5,5;4;4,2;5,4;5,3;6,4;7,5;5,2;7,5;5,4;7,3;5;5,2;7,5;6,4;7,5;5,2;7,5;9,3;8,4;7,5;9,2;7,5;9,4;7,3;5;9,2;7,5;9,3;5;10,5;3;9,5;4;10,2;9,4;10,3;5;12,3;5;4;13,2;12,4;3;4;5;2;13,5;3;4;3;5;12,2;13,5;12,5;4;13,2;12,4;3;11,4;10,5;12,2;10,5;12,4;10,3;5;12,2;10,5;11,4;10,5;12,2;10,5;9,3;5;10,5;9,5;4;10,2;9,4]</code></p><p>西麓堂春晓吟第一段（集成 3 册页 176）</p><p><code>s,2;7;5;9,7;s,2;5;9,7;s,2;3;2;7;5;9,7;s,2;5;9,7;10,6;qi;s,5;2;10,5;10,6;11,3;10,5;10,5;l,12;14,4;14,1;13,2;l,10;l,9;s,5;9,3;9,4;8.5,5;7.8,5;zh;l,8.5;9,4;9,3;8.5,5;l,7.6;s,2;9,4;7,7;l,7.6;8,6;8,3;7.6,4;l,7;7,5;7,2;7,7;zh;l,7.6;s,5;9,7;10,6;9,7;9,2;9,6;9,6;zh;l,10;10,5;11,3;qi;10,7;6;l,9;s,2;14,6</code></p><h2>筮法</h2><p>第一種周易筮法是通行算法，6、9為變爻，需變換陰陽。</p><p>第二種周易筮法是獨立算得兩卦，陰陽變了的作為變爻。</p><h3>參考資料</h3><p>清華簡《筮法》的算法構擬採用杨胜男、王承略《大衍揲扐法与清华简〈筮法〉揲扐法再探讨》，《周易研究》2021年第3期。</p><p>完全不瞭解的同學可以隨便看看這些：</p><ul><li>曾仕強大衍筮法教學視頻</li><li>踏歌：<a href="https://zhuanlan.zhihu.com/p/24635455">如何做一名正宗的神棍——大衍之数</a></li><li>洛神：<a href="https://www.douban.com/note/731868226/">易经第二十讲：起卦方法</a>，2019-08-26</li></ul><p>其他：</p><ul><li>踏歌：<a href="https://zhuanlan.zhihu.com/p/35426606">命理测试的分析结果：和普通人猜没有显著差异</a> 〔不過最後提到了一個人，準確率很高〕</li></ul>