## 簡介

1. 本工具的使用對象是古代天文曆法研究者。對於一般文史研究者，推薦使用下面的友情鏈接<n>當然，「時間」板塊的三個工具還是挺有用的</n>。
2. 目前的古代朔閏査詢網站都是根據工具書、文獻材料手動調整的<n>參考中研院 [兩千年中西曆轉換說明書](https://sinocal.sinica.edu.tw/lusodoc.html)，廖育棟 [本網站的農曆編算](https://ytliu0.github.io/ChineseCalendar/computation_chinese.html)</n>。本工具可提供古代實行未實行的 60 餘部曆法的計算，完全遵照各曆算法進行全自動計算，無手動干預。主要有三大功能區：
    1. **朔閏表** 每年的積年、冬至大小餘、閏餘；冬至時刻的入轉日、入交泛日、入週天度。各月定朔<n>線性內插、二次三次內插</n>、平朔，定朔時刻日月所在赤道度，定望，平氣、定氣、定氣日昏中星。日月食食甚時刻、食分。
    2. **曆書** 包含天文曆、具注曆兩部份。
        1. 天文曆：每日太陽赤經、極黃經宿度，日赤緯、日出時刻、正午晷長，月赤經、月赤緯、月行九道/三道。預計 2022 年將推出五星計算。
        2. 具注曆：每年「術數年」積年、男女九宮，年干支五行、納音、魁罡之月，23 種歲神，年九宮色。每月月建、月神、吉時、月九宮色。每日干支、儒略日、公曆日期、納音五行、建除、黃道吉日黑道凶日、七星值日、二十八宿二十八禽值日，二十四節氣時刻、七十二候時刻、沒滅日時刻、土王用事時刻、卦用事時刻，人神、日遊神、血支血忌，10 種日神。
    3. **數學工具** 包含同餘、方程、天文、時間四個板塊。
        1. 同餘：大衍求一術、解一次同餘式、大衍總數術，擬秦九韶調日法、淸人調日法三種、連分數，最大公因數、章蔀紀元法，古曆入元、秦九韶演紀法，從零開始造唐宋曆。
        2. 方程：~~九章算術開方術、累減開方術，~~二分迭代法解高次方程，隙積術芻童垛、三角垛落一形垛、四角垛方垛，招差術、拉格朗日內插，會圓術、弧矢割圓術、三斜求積術。
        3. 天文：日躔月離及誤差，太陽赤黃經轉換及誤差，太陽赤緯、日出、晷長及誤差，月亮極白經、赤經、極黃緯，現代天文任意時刻太陽高度、方位角、晷長。
        4. 時間：將萬分小數轉換爲辰刻，儒略日、日期轉換，公元年、年干支轉換。
3. 如您發現任何問題，可通過評論框或郵件向我反饋。若您在研究過程中發現程序結果與文獻不符，望不吝提供線索。這個工具是根據研究需要而開發的，如果您有任何功能需求，敬請與我聯繫，我會在力所能及的範圍內儘量實現。
5. 本工具與以往的朔閏表工具書是相互補充的關係，古人算曆有可能不會完全依照術文，會根據實際情況適當調整，這種情況下計算程序就無能爲力。
6. 本工具完全開源，如您需要査詢、核査各曆的詳細參數與算法，請前往源碼倉庫。如您不嫌麻煩，可以下載源碼，在本地運行程序。更多技術特徵見開發者說明。核心計算邏輯文件大小：253KB。 **隱私聲明** 本站使用了 Google Analytics 進行流量分析；評論系統採用 Hyvor Talk；服務器託管在 Netlify 平臺。運算均在本地瀏覽器進行。
6. 可以參考《律曆初階下》：
    1. [曆法簡史](https://kqh.me/key/calendar1)
    2. [天學](https://kqh.me/key/calendar2)
    3. [天文計算](https://kqh.me/key/calendar3)
    4. [四分系](https://kqh.me/key/calendar4)
    5. [日神、時間制度](https://kqh.me/key/calendar6)
    6. [數學工具](https://kqh.me/key/calendar7)。本站參考資料見此

## 網站推薦

### 年表

- [廖育棟的網站](https://ytliu0.github.io/ChineseCalendar/index_chinese.html) 年曆、氣朔時刻、中國歷史年表、儒略日干支轉換等——DE431
- 中研院 [兩千年中西曆轉換](https://sinocal.sinica.edu.tw/)
- [歷史車輪中西曆轉換器](https://www.lishichelun.com/calendar/switch)

### 實行曆法

- [和暦 (わごよみ) & 中華暦（からごよみ）](http://www.wagoyomi.info/) 〔寶藏！〕
- 廖育棟的 [時憲曆計算](http://ytliu.epizy.com/Shixian/index_chinese.html)
- [紀年轉換工具](https://kanasimi.github.io/CeJS/_test%20suite/era.htm)：世界各國曆法

### 現代天文學中曆

- [日梭萬年曆](http://www.tianqihoubao.com/calendar/calendar.htm)
- [壽星天文曆](http://www.nongli.net/sxwnl/)，許劍偉、鄭彥山——VSOP
- [萬年天文夏曆](https://vert.neocities.org/cld/)，哂蟹齋

### 現代天文學朔閏、交食

- [Eight Millennia of Eclipses (4000 BCE – 4000 CE)](http://ytliu.epizy.com/eclipse/) 廖育棟的
- [NASA Eclipse](https://eclipse.gsfc.nasa.gov/) 五千年，VSOP、ELP-2000/82 算的，太老了
- [日本國立天文臺在線曆表](https://eco.mtk.nao.ac.jp/koyomi/cande/index.html.en) 有 2009 年以來的七政位置、朔閏、節氣、交食、恆星時等等

### 博客

- [治曆者言](https://tambingblog.wordpress.com/) 譚冰的曆法及術數文章彙編 似乎是港中文的畢業生？出版有<v>古今曆術考</v><n>香港：三聯書店，2013</n>。

## 殘曆復原

### 參數

魏<u>韓詡</u>造<v>黃初</v>，他批評<v>乾象</v>減斗分太過<n>回歸年太小</n>，不過實際上<q>「<u>韓翊</u>所造皆用<u>洪</u>法，小益斗下分，所錯無幾。」</q><n>我據占經復原<v>黃初</v>。

晉武帝泰始十年<n>274</n><u>劉智</u><v>正曆</v><n>我據占經、宋志復原。

永和八年<n>352</n><u>王朔之</u><v>通曆</v>，<v>宋志</v>：<q>「王朔之以其上元歲在甲子，善其術，欲以九萬七千歲之甲子爲開闢之始，何承天云『悼於立意者也。』」</q>但 97000 的積年完全不對，我調整爲 352 - (97000 - 864)，九萬七千歲是舉整數而言。後來看到曲安京<v>中國曆法與數學</v>，改爲 352 - 90079 試了下<n>上元甲午歲壬子日</n>，但是前後錯開兩個月，肯定不能用。

<u>姜岌</u><v>三紀甲子元</v>。我據晉志下、占經復原。

<u>趙𢾺</u><v>玄始</v><n>玄始元年 412—北涼亡</n>。我據占經、<v>疇人傳</v>卷六復原。

<v>隋志</v>這段材料很重要，576 年：

> 訖干敬禮及曆家豫刻日食疎密。六月戊申朔，太陽虧，劉孝孫言食於卯時<n>6—7 點</n>，張孟賔言食於甲時<n>5—6 點</n>，鄭元偉、董峻言食於辰時<n>8—9 點</n>，宋景業言食於巳時<n>10—11 點</n>。至日食，乃於卯甲之間<n>6 點</n>，其言皆不能中。

這裏用的是 24 小時方位制計時。

<u>宋景業</u><v>天保</v><n>天保二年 551—亡</n>，月離表據嚴敦傑<v>補北齊書曆志</v><n><v>自然科學史研究</v>1984 年第 3 期</n>補之。問題是戊申定朔在巽時弱，距巳時<n>0.417-0.45</n>還差了一個多小時。

<u>董峻</u>、<u>鄭元偉</u><v>甲寅元</v>，據嚴敦傑<v>補北齊書曆志</v>、曲安京<v>曆法</v>頁 106 補之。曲安京說<v>甲寅</v>沒有日行盈縮，看來我判斷它是北系曆法是正確的。此前用嚴敦傑的上元積年，自己補上了入轉修正，照理說不應該有，後來用曲安京積年，不用補，非常完美。

<v>張孟賔</v>、<v>劉孝孫</v>二曆以占經復原，<v>劉孝孫</v>很完整，<v>張孟賔</v>殘缺。<v>張孟賔</v>此前積年不對，我加上了 -0.379 的經朔修正，後來用曲安京積年，就不用補了。曲安京沒有復原近點月，我用「從零開始造唐宋曆」工具復原，算得甲時少彊，完美貼合記載。日躔月離此前以<v>皇極</v>補之，但改用<v>大業</v>躔離纔能與<v>隋志</v>相合。

<v>隋志</v>還說：

> 張孟賔以六百一十九爲章，四萬八千九百爲紀，九百四十八爲日法，萬千九百四十五爲斗分。元紀共命，法略旨遠。日月五星，並從斗十一起。盈縮轉度，陰陽分至，與漏刻相符，共日影俱合，循轉無窮。上拒春秋，下盡天統，日月虧食及五星所在，以二人新法考之，無有不合。

「從斗十一起」，說明<v>張孟賔</v>沒有歲差。

<v>明克讓</v><n>武成元年 559—565</n>。我用占經的<v>梁武大同</v>來補<v>明克讓</v>。<v>隋志中</v>：<q>「初，西魏入關，尚行李業興<v>正光術</v>。至武成元年，始詔克讓與麟趾學士庾季才及諸日者定新術，采<u>祖暅</u>舊議，通簡南北之術。自斯已後，頗親其謬。故周齊並時，而曆差一日。」</q>也就是說<v>明克讓</v>綜合南北算法，跟<v>天保</v>差了一天。

<v>大象</v><n>大象元年 579—583</n>。<v>通占大象曆星經</v>與大象曆配套使用，可能是張賔所作<n>許潔<v>隋唐時期的道教星象研究</v>，<v>宗教學研究</v>2009 年第 4 期，第 29 頁</n>，也許可以用來復原大象曆。<v>隋書張冑玄傳</v>：<q>「周马显造 <v>丙寅元历</v>，有阴阳转法，加减章分，进退蚀余，乃推定日，创开此数。当时术者，多不能晓。张宾因而用之，莫能考正。」</q><v>隋書</v>：<q>「小周餘、盈縮積，其曆術別推入蔀會，分用陽率 499，陰率 9。每 12 月下各有日月蝕轉分，推步加減之，乃爲定蝕大小餘，而求加時之正。」</q>

高宗顯慶年間<n>656—661</n>印度曆法<v>九執</v>，全文見占經卷一〇四，顧觀光<v>九執曆解</v><n><v>武陵山人遺書</v>，<v>中國科學技術典籍通匯</v>天文部分 843 頁</n>

術士<u>曹士蔿</u><v>符天</v><n>780-820</n>乃民間小曆，以<q>「相減相乘法」</q>代躔離表，日法用萬分，曆元用雨水，以定氣注曆。<v>崇玄</v>本於<v>大衍</v>，而巧算源自<v>符天</v>。<n>陳久金<v>符天曆研究</v>：<u>祖暅</u>的<v>符天經</v>與後來的<v>符天曆</v>毫無關係。</n>

<v>至道</v>上元積年、回歸年、朔望月用曲安京的復原成果，其他參數參照<v>乾元</v> 995 年轉 27.1173 交 7.5243 週 323.2491，用「從零開始造唐宋曆」工具復原。

<v>乾興</v>其他參數參照<v>觀天</v> 1021 年轉 17.1709 交 6.9028 週 319.5299，用「從零開始造唐宋曆」工具復原。

<v>調元</v>。<v>新五代志</v>：<q>「以宣明之氣朔合崇元之五星，二曆相參，然後符合。」</q>失傳，以我復原的<v>符天</v>代之，參數暫用<v>崇玄</v>，算法用相減相乘法。<n>算法見陳久金<v>符天曆研究</v>。</n>劉義叟見到<v>調元</v>原文，其<v>長曆</v>可信<n>見邱靖嘉<v>遼史曆象志溯源</v>，<v>中華文史論叢</v>2012 第 4 期</n>，那麼接下來的工作就是以我復原的核對<v>長曆</v>。

<v>遼志下</v>的這段記載比較胡扯：

> 遼、漢、周、宋，俱行夏時，各自爲曆。國史閏朔，頗有異同。遼初用乙未元曆，本何承天元嘉曆法；後用大明曆，本祖冲之甲子元曆法。承天日食晦朏，一章必七閏；冲之日食必朔，或四年一閏。用乙未曆，漢、周多同；用大明曆，則間與宋異。國史敍事，甲子不殊，閏朔多異，以此故也。耶律儼紀以大明法追正乙未月朔，又與陳大任紀時或牴牾。

遼金的曆法和<v>元嘉</v>、<v>祖沖之</v>風馬牛不相及。

<v>疇人傳宋二姚舜輔</v>：

> 有司以<v>觀天</v>推崇寧二年<n>1103</n>十一月朔爲丙子。頒秝之後，始悟其朔當進而失進，遂造<v>占天術</v>，改十一月朔爲丁丑，而再頒秝焉。其法上元甲子距崇寧二年癸未，積二千五百五十萬一千七百五十九，日法二萬二千八十。

從這段描述可知，<v>占天</v>應該跟<v>觀天</v>一模一樣。我算出來<v>觀天</v>丙子 7420 不進朔，<v>占天</v> 7461 亦不當進朔。十一月在秋分至春分，進朔標準應該是 7500，這個積年是有問題的。在觀天基礎上將平朔加一刻重新算上元積年。

<v>淳祐</v>、<v>會天</v>歲實、上元積年改用曲安京引用的參數。根據<v>寶祐四年會天曆</v>，1256 年年中冬至當爲癸丑 0.25—0.26 之間。歲實、上元積年改用曲安京引用的參數。1250 年<v>開禧</v>轉 15.5498 交 23.8590，<v>成天</v>轉 15.4620 交 23.7932，範圍兩者之間。

<v>楊級大明</v>用 1180 年<v>重修大明</v>轉 19.0981 交 9.1719。

<v>乙未</v>上元積年、歲差用曲安京復原成果，其餘參數根據重修大明 1180 年轉 19.0981 交 9.1719 算得。

六部太乙曆：秦漢時期的<v>甲寅太乙</v>，南北朝的<v>宋琨太乙</v>，唐代王希明的<v>開元太乙</v>，宋代的<v>景祐太乙</v>，金張行簡的<v>太乙</v>，元曉山老人的<v>太乙統宗寶鑑曆</v>。根據曲安京<v>曆法</v>第七章補。

### 天文計算

很多曆法的天文計算闕如，我用相鄰曆法來補：

#### 月離

- **乾象** 黃初
- **景初** 劉智、王朔之、三紀
- **正光** 玄始
- **天保** 甲寅、天和、大象<n>大象、張賔曆自成一系，不當用天保補。</n>、開皇
- **大明** 梁武

#### 躔離

- **大業** 張孟賔、劉孝孫
- **麟德** 神龍
- **大衍** 至德
- 欽天：月離用五紀、紀元二曆平均<n>因爲再近一些的都是遠地點入轉了，而欽天是近地點入轉</n>，並用 9 段 248 限法重造月離表。日躔用崇玄。
- **乾元** 至道
- **崇天** 乾興
- 奉元、占天：日躔用崇天、紀元二曆平均，月離用崇天、觀天二曆平均
- 淳祐、會天：用統天、開禧、成天三曆平均
- **紀元** 楊級大明
- **重修大明** 乙未、庚午

#### 夜漏、晷長、日緯

- **四分** 顓頊、太初、乾象、黃初、景初、劉智、王朔之、三紀、玄始、正光、興和、天保、甲寅、天和、大象、開皇
- **麟德** 神龍
- **大衍** 五紀、正元
- **崇玄** 欽天日躔表有赤道內外度，但日躔月曆表均無傳，只能用崇玄代。日食黃道內外差需要用赤道內外分。
- **觀天** 奉元、占天
- **重修大明** 乙未、庚午

#### 夜漏

- **大明** 梁武
- **皇極** 張孟賔、劉孝孫

#### 晷長

- **大明** 梁武、大業、戊寅、張孟賔、劉孝孫、皇極

#### 日緯

- **四分** 元嘉、大明、梁武、大業、戊寅、張孟賔、劉孝孫、皇極
- **應天** 乾元

#### 月緯

- **乾象** 黃初、景初、劉智、王朔之、三紀、玄始、正光、興和、天保、甲寅、天和、大象、開皇
- **大明** 梁武、大業、戊寅
- **皇極** 張孟賔、劉孝孫
- **麟德** 神龍

## Todo list

#### 核心

- 九道術、授時黃白轉換尙不可靠。天文曆的月亮位置也有點問題。
- MoonTcorrTable1或許要分段求MoonDifAccum1，以後再說。
- 欽天曆求月離入轉，要先加上太陽改正，以後再看其他曆是否需要。
- 遙遙無期的五星計算
- 唐曆月離的第二遍修正<n>影響很小，最多 5/10000 日</n>
- 增加黃道過宮<n>不重要</n>
- 細化曆書的日神<n>不重要</n>

##### 前端

- 雙語支持
- 新的曆法選擇框

### Known Issues

- 朔閏表725年麟德節氣沒有宿度。
- 日月食計算應該還有一些小問題：<v>應天</v>怪怪的。
- <v>劉孝孫</v>入交不對。<v>觀天</v>入交不對，重新擬了一個交點月，暫時糊弄過去。
- <v>五紀</v>、<v>正元</v>月緯的比例沒找到，只能先暫時瞎填一個湊數。

##### 前端

- 現在打包文件已經超過了 244kb 的推薦大小。
- 朔閏表在特定情況下會重合在一起。
